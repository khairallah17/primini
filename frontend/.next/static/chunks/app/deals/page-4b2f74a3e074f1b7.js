(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3772],{7597:function(e,t,s){Promise.resolve().then(s.bind(s,7872))},6847:function(e,t,s){"use strict";s.d(t,{Z:function(){return c}});var a=s(7437),l=s(6648),i=s(7138),r=s(2265),n=s(8618),o=s(357);function c(e){var t,s;let{product:c}=e,{addFavorite:d,removeFavorite:u,isFavorite:m}=(0,n.r)(),p=m(c.id),[x,f]=(0,r.useState)(!1),[h,g]=(0,r.useState)(null),b=e=>{if(!e)return null;if(e.startsWith("http://")||e.startsWith("https://"))return e;if(e.startsWith("/media/")||e.startsWith("media/")){let t=(o.env.NEXT_PUBLIC_API_URL||"http://localhost:8000/api").replace("/api",""),s=e.startsWith("/")?e:"/".concat(e);return"".concat(t).concat(s)}if(!e.startsWith("/")){let t=(o.env.NEXT_PUBLIC_API_URL||"http://localhost:8000/api").replace("/api","");return"".concat(t,"/media/products/").concat(e)}return e},v=(0,r.useMemo)(()=>c.image_display?c.image_display:c.image_file?b(c.image_file):c.image?b(c.image):null,[c.image_display,c.image_file,c.image]),w=(null===(t=c.tags)||void 0===t?void 0:t.slice(0,3))||[],N=null!==(s=c.lowestPrice)&&void 0!==s?s:c.lowest_price,_=null!=N?"string"==typeof N?parseFloat(N):N:null,j=h||v;return(0,a.jsx)(i.default,{href:"/product/".concat(c.slug),className:"block h-full",children:(0,a.jsxs)("article",{className:"flex h-full flex-col justify-between rounded-3xl border border-slate-200 bg-white p-5 shadow-sm transition hover:-translate-y-1 hover:shadow-lg cursor-pointer",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[j&&!x?(0,a.jsxs)("div",{className:"relative aspect-[4/3] overflow-hidden rounded-2xl bg-white",children:[w.length>0&&(0,a.jsx)("div",{className:"absolute top-2 left-2 z-10 flex flex-wrap gap-1.5",children:w.map((e,t)=>(0,a.jsx)("span",{className:"px-2 py-0.5 text-[10px] sm:text-xs font-medium bg-white/90 backdrop-blur-sm text-slate-700 rounded-full border border-slate-200 shadow-sm",children:e},t))}),(0,a.jsx)("div",{className:"absolute inset-2 sm:inset-3",children:(0,a.jsx)(l.default,{src:j,alt:c.name,fill:!0,className:"object-contain transition-transform duration-300 hover:scale-105",sizes:"(max-width: 640px) 100vw, (max-width: 768px) 50vw, (max-width: 1024px) 33vw, 25vw",quality:90,priority:!1,loading:"lazy",placeholder:"blur",blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mN8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==",onError:()=>{let e=h===c.image_display||!h&&v===c.image_display,t=h===b(c.image_file)||!h&&v===b(c.image_file);if(e&&c.image_file){let e=b(c.image_file);if(e&&e!==h){g(e),f(!1);return}}if((e||t)&&c.image){let e=b(c.image);if(e&&e!==h&&e!==v){g(e),f(!1);return}}f(!0)}})})]}):(0,a.jsxs)("div",{className:"relative aspect-[4/3] flex items-center justify-center rounded-2xl bg-gradient-to-br from-slate-100 to-slate-200",children:[w.length>0&&(0,a.jsx)("div",{className:"absolute top-2 left-2 z-10 flex flex-wrap gap-1.5",children:w.map((e,t)=>(0,a.jsx)("span",{className:"px-2 py-0.5 text-[10px] sm:text-xs font-medium bg-white/90 backdrop-blur-sm text-slate-700 rounded-full border border-slate-200 shadow-sm",children:e},t))}),(0,a.jsx)("span",{className:"text-xs font-medium text-slate-400",children:"Aucune image"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-slate-800",children:c.name}),c.description&&(0,a.jsx)("p",{className:"mt-2 line-clamp-3 text-xs text-slate-500",children:c.description.replace(/\*\*/g,"").replace(/\*/g,"").replace(/__/g,"").replace(/_/g,"").replace(/\[([^\]]+)\]\([^\)]+\)/g,"$1").replace(/`/g,"").trim()})]})]}),(0,a.jsxs)("div",{className:"mt-4 flex items-center justify-between",children:[null===_||isNaN(_)?(0,a.jsx)("p",{className:"text-sm text-slate-500",children:"Prix en attente"}):(0,a.jsxs)("p",{className:"text-sm font-semibold text-primary",children:[_.toFixed(3)," MAD"]}),(0,a.jsx)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),p?u(c.id):d(c)},className:"rounded-full px-3 py-2 text-xs font-semibold ".concat(p?"bg-secondary text-white":"bg-slate-200 text-slate-700"),type:"button",children:p?"Retirer":"Favori"})]})]})})}},7872:function(e,t,s){"use strict";s.d(t,{default:function(){return n}});var a=s(7437),l=s(2265),i=s(6847),r=s(9988);function n(){let[e,t]=(0,l.useState)([]),[s,n]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{(async function(){try{let e=await r.Z.get("/products/",{params:{ordering:"-lowest_price",page_size:12}});t(e.data.results.map(e=>{var t;return{...e,lowestPrice:null!==(t=e.lowestPrice)&&void 0!==t?t:e.lowest_price}}))}catch(e){console.warn("Failed to load deals",e)}finally{n(!1)}})()},[]),(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("header",{className:"space-y-2",children:[(0,a.jsx)("h1",{className:"text-3xl font-semibold text-slate-900",children:"Bons plans du moment"}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:"S\xe9lection quotidienne des meilleures promotions d\xe9nich\xe9es chez nos marchands partenaires."})]}),s?(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map((e,t)=>(0,a.jsx)("div",{className:"h-60 animate-pulse rounded-3xl bg-gradient-to-br from-slate-100 to-slate-200"},t))}):e.length>0?(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:e.map(e=>(0,a.jsx)(i.Z,{product:e},e.id))}):(0,a.jsx)("p",{className:"rounded-3xl border border-dashed border-slate-200 bg-white p-10 text-center text-sm text-slate-500",children:"Les bons plans reviendront bient\xf4t. Revenez plus tard !"})]})}},8618:function(e,t,s){"use strict";s.d(t,{c:function(){return n},r:function(){return o}});var a=s(7437),l=s(2265);let i=(0,l.createContext)(void 0),r="primini_favorites";function n(e){let{children:t}=e,[s,n]=(0,l.useState)([]);(0,l.useEffect)(()=>{try{let e=window.localStorage.getItem(r);e&&n(JSON.parse(e))}catch(e){console.warn("Failed to restore favorites",e)}},[]),(0,l.useEffect)(()=>{window.localStorage.setItem(r,JSON.stringify(s))},[s]);let o=(0,l.useCallback)(e=>{n(t=>t.some(t=>t.id===e.id)?t:[...t,e])},[]),c=(0,l.useCallback)(e=>{n(t=>t.filter(t=>t.id!==e))},[]),d=(0,l.useCallback)(e=>s.some(t=>t.id===e),[s]),u=(0,l.useMemo)(()=>({favorites:s,addFavorite:o,removeFavorite:c,isFavorite:d}),[o,s,d,c]);return(0,a.jsx)(i.Provider,{value:u,children:t})}function o(){let e=(0,l.useContext)(i);if(!e)throw Error("useFavorites must be used within FavoritesProvider");return e}},9988:function(e,t,s){"use strict";var a,l=s(8472),i=s(357);let r=l.Z.create({baseURL:null!==(a=i.env.NEXT_PUBLIC_API_URL)&&void 0!==a?a:"http://localhost:8000/api",withCredentials:!1});t.Z=r}},function(e){e.O(0,[8472,231,4974,2971,7023,1744],function(){return e(e.s=7597)}),_N_E=e.O()}]);