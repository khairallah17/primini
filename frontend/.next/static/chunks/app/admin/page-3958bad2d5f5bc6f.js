(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{8215:function(e,t,r){Promise.resolve().then(r.bind(r,1320)),Promise.resolve().then(r.bind(r,912)),Promise.resolve().then(r.bind(r,1481))},1320:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var a=r(7437),s=r(2265),n=r(6463),l=r(3429),i=r(75),o=r(7138),d=r(357);function c(){(0,n.useRouter)();let{tokens:e}=(0,l.a)(),[t,r]=(0,s.useState)("pending"),[c,u]=(0,s.useState)(!0),[x,p]=(0,s.useState)([]),[g,m]=(0,s.useState)(null),[h,y]=(0,s.useState)([]),[f,v]=(0,s.useState)(null),[b,j]=(0,s.useState)(null),[w,N]=(0,s.useState)(null),[k,_]=(0,s.useState)(null),[S,A]=(0,s.useState)({}),[C,P]=(0,s.useState)({}),[E,R]=(0,s.useState)(null),[T,L]=(0,s.useState)(null),[B,U]=(0,s.useState)(""),[F,I]=(0,s.useState)(""),[Z,O]=(0,s.useState)(null),[z,M]=(0,s.useState)({});(0,s.useEffect)(()=>{(null==e?void 0:e.key)&&(D(),"pending"===t&&J())},[e,t,B]),(0,s.useEffect)(()=>{if("all"!==t)return;Z&&clearTimeout(Z);let r=setTimeout(()=>{(null==e?void 0:e.key)&&D(1)},500);return O(r),()=>{r&&clearTimeout(r)}},[F]);let D=async function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(null==e?void 0:e.key){u(!0),j(null);try{let a;a="pending"===t?await (0,i.BB)(e.key,r):"all"===t?await (0,i.Dg)(e.key,r,B||void 0,F||void 0):await (0,i.ch)(e.key,r,B||void 0),p(a.results),m(a)}catch(e){var a,s;j((null===(s=e.response)||void 0===s?void 0:null===(a=s.data)||void 0===a?void 0:a.detail)||e.message||"Erreur lors du chargement")}finally{u(!1)}}},J=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(null==e?void 0:e.key)try{let r=await (0,i.EE)(e.key,t);y(r.results),v(r)}catch(e){console.error("Error loading pending offers:",e)}},W=async t=>{if(null==e?void 0:e.key){_(t);try{await (0,i.kR)(t,e.key),await J((null==f?void 0:f.current_page)||1)}catch(e){var r,a;j((null===(a=e.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.detail)||e.message||"Erreur lors de l'approbation")}finally{_(null)}}},X=async t=>{if(!(null==e?void 0:e.key))return;let r=C[t]||"";if(!r.trim()){j("Veuillez fournir une raison de rejet");return}_(t);try{await (0,i.t$)(t,r,e.key),L(null),P({...C,[t]:""}),await J((null==f?void 0:f.current_page)||1)}catch(e){var a,s;j((null===(s=e.response)||void 0===s?void 0:null===(a=s.data)||void 0===a?void 0:a.detail)||e.message||"Erreur lors du rejet")}finally{_(null)}},K=async t=>{if(null==e?void 0:e.key){N(t);try{await (0,i.h7)(t,e.key),await D((null==g?void 0:g.current_page)||1)}catch(e){var r,a;j((null===(a=e.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.detail)||e.message||"Erreur lors de l'approbation")}finally{N(null)}}},H=async t=>{if(!(null==e?void 0:e.key))return;let r=S[t]||"";if(!r.trim()){j("Veuillez fournir une raison de rejet");return}N(t);try{await (0,i.ex)(t,r,e.key),R(null),A({...S,[t]:""}),await D((null==g?void 0:g.current_page)||1)}catch(e){var a,s;j((null===(s=e.response)||void 0===s?void 0:null===(a=s.data)||void 0===a?void 0:a.detail)||e.message||"Erreur lors du rejet")}finally{N(null)}},V=e=>e?(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat({pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"}[e]||"bg-gray-100 text-gray-800"),children:{pending:"En attente",approved:"Approuv\xe9",rejected:"Rejet\xe9"}[e]||e}):null,$=e=>{M(t=>({...t,[e]:!0}))},q=e=>{if(e.image_display)return e.image_display;if(e.image_file){let t=d.env.NEXT_PUBLIC_API_BASE_URL?d.env.NEXT_PUBLIC_API_BASE_URL.replace("/api",""):"http://localhost:8000",r=e.image_file.startsWith("/")?e.image_file:"/".concat(e.image_file);return"".concat(t).concat(r)}if(!e.image)return null;if(e.image.startsWith("http://")||e.image.startsWith("https://"))return e.image;if(e.image.startsWith("/media/")||e.image.startsWith("media/")){let t=d.env.NEXT_PUBLIC_API_BASE_URL?d.env.NEXT_PUBLIC_API_BASE_URL.replace("/api",""):"http://localhost:8000",r=e.image.startsWith("/")?e.image:"/".concat(e.image);return"".concat(t).concat(r)}if(!e.image.includes("://")){let t=d.env.NEXT_PUBLIC_API_BASE_URL?d.env.NEXT_PUBLIC_API_BASE_URL.replace("/api",""):"http://localhost:8000",r=e.image.startsWith("/")?e.image:"/media/products/".concat(e.image);return"".concat(t).concat(r)}return e.image},G=e=>{let r=q(e);return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[r&&!z[e.id]?(0,a.jsx)("img",{src:r,alt:e.name,className:"h-12 w-12 rounded object-cover mr-4",onError:()=>$(e.id)}):(0,a.jsx)("div",{className:"h-12 w-12 rounded bg-gray-200 mr-4 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"N/A"})}),(0,a.jsxs)("div",{children:[e.slug?(0,a.jsx)(o.default,{href:"/product/".concat(e.slug),className:"text-sm font-medium text-gray-900 hover:text-primary",children:e.name}):(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.name}),e.brand&&(0,a.jsx)("p",{className:"text-sm text-gray-500",children:e.brand})]})]})}),"all"===t&&(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:V(e.approval_status)}),"my"!==t&&(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.created_by_email||"admin"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.created_at?new Date(e.created_at).toLocaleDateString("fr-FR"):"N/A"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsx)("div",{className:"flex justify-end gap-2",children:"pending"===t?E===e.slug?(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)("textarea",{placeholder:"Raison du rejet...",value:S[e.slug]||"",onChange:t=>A({...S,[e.slug]:t.target.value}),className:"w-full rounded-md border-gray-300 text-sm",rows:2}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>H(e.slug),disabled:w===e.slug,className:"rounded-md bg-red-600 px-3 py-1 text-xs text-white hover:bg-red-700 disabled:opacity-50",children:w===e.slug?"...":"Confirmer"}),(0,a.jsx)("button",{onClick:()=>{R(null),A({...S,[e.slug]:""})},className:"rounded-md bg-gray-200 px-3 py-1 text-xs text-gray-700 hover:bg-gray-300",children:"Annuler"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>K(e.slug),disabled:w===e.slug,className:"rounded-md bg-green-600 px-3 py-1 text-xs text-white hover:bg-green-700 disabled:opacity-50",children:w===e.slug?"...":"Approuver"}),(0,a.jsx)("button",{onClick:()=>R(e.slug),disabled:w===e.slug,className:"rounded-md bg-red-600 px-3 py-1 text-xs text-white hover:bg-red-700 disabled:opacity-50",children:"Rejeter"})]}):(0,a.jsxs)(a.Fragment,{children:[e.slug?(0,a.jsx)(o.default,{href:"/products/".concat(e.slug,"/edit"),className:"rounded-md bg-blue-600 px-3 py-1 text-xs text-white hover:bg-blue-700",children:"Modifier"}):(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"N/A"}),"all"===t&&"pending"===e.approval_status&&(E===e.slug?(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)("textarea",{placeholder:"Raison du rejet...",value:S[e.slug]||"",onChange:t=>A({...S,[e.slug]:t.target.value}),className:"w-full rounded-md border-gray-300 text-sm",rows:2}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>H(e.slug),disabled:w===e.slug,className:"rounded-md bg-red-600 px-3 py-1 text-xs text-white hover:bg-red-700 disabled:opacity-50",children:w===e.slug?"...":"Confirmer"}),(0,a.jsx)("button",{onClick:()=>{R(null),A({...S,[e.slug]:""})},className:"rounded-md bg-gray-200 px-3 py-1 text-xs text-gray-700 hover:bg-gray-300",children:"Annuler"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>K(e.slug),disabled:w===e.slug,className:"rounded-md bg-green-600 px-3 py-1 text-xs text-white hover:bg-green-700 disabled:opacity-50",children:w===e.slug?"...":"Approuver"}),(0,a.jsx)("button",{onClick:()=>R(e.slug),disabled:w===e.slug,className:"rounded-md bg-red-600 px-3 py-1 text-xs text-white hover:bg-red-700 disabled:opacity-50",children:"Rejeter"})]}))]})})})]},e.id)};return c&&!x.length?(0,a.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,a.jsx)("div",{className:"text-lg",children:"Chargement..."})}):(0,a.jsx)("div",{className:"h-full w-full bg-gray-50 py-8 px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"mx-auto w-full max-w-7xl",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Tableau de bord Admin"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"G\xe9rez les produits, utilisateurs et param\xe8tres"})]})}),(0,a.jsx)("div",{className:"mb-6 border-b border-gray-200",children:(0,a.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,a.jsxs)("button",{onClick:()=>{r("pending"),U(""),I("")},className:"whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium ".concat("pending"===t?"border-primary text-primary":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"),children:["En attente","pending"===t&&(0,a.jsx)("span",{className:"ml-2 rounded-full bg-primary px-2 py-0.5 text-xs text-white",children:((null==g?void 0:g.count)||0)+((null==f?void 0:f.count)||0)})]}),(0,a.jsx)("button",{onClick:()=>{r("all"),U(""),I("")},className:"whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium ".concat("all"===t?"border-primary text-primary":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"),children:"Tous les produits"}),(0,a.jsx)("button",{onClick:()=>{r("my"),U(""),I("")},className:"whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium ".concat("my"===t?"border-primary text-primary":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"),children:"Mes produits"})]})}),"all"===t&&(0,a.jsxs)("div",{className:"mb-6 flex gap-4 rounded-md bg-white p-4 shadow",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("input",{type:"text",placeholder:"Rechercher un produit...",value:F,onChange:e=>I(e.target.value),className:"w-full rounded-md border-gray-300 px-3 py-2 text-sm"})}),(0,a.jsxs)("select",{value:B,onChange:e=>{U(e.target.value),D(1)},className:"rounded-md border-gray-300 px-3 py-2 text-sm",children:[(0,a.jsx)("option",{value:"",children:"Tous les statuts"}),(0,a.jsx)("option",{value:"pending",children:"En attente"}),(0,a.jsx)("option",{value:"approved",children:"Approuv\xe9"}),(0,a.jsx)("option",{value:"rejected",children:"Rejet\xe9"})]})]}),"my"===t&&(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("select",{value:B,onChange:e=>{U(e.target.value),D(1)},className:"rounded-md border-gray-300 px-3 py-2 text-sm",children:[(0,a.jsx)("option",{value:"",children:"Tous les statuts"}),(0,a.jsx)("option",{value:"pending",children:"En attente"}),(0,a.jsx)("option",{value:"approved",children:"Approuv\xe9"}),(0,a.jsx)("option",{value:"rejected",children:"Rejet\xe9"})]})}),"pending"===t&&(0,a.jsxs)("div",{className:"mb-6 rounded-md bg-blue-50 p-4 text-blue-800",children:[(0,a.jsx)("p",{className:"font-semibold",children:"\xc9l\xe9ments en attente d'approbation"}),(0,a.jsxs)("p",{className:"mt-1 text-sm",children:[(null==g?void 0:g.count)||0," produit(s) et ",(null==f?void 0:f.count)||0," offre(s) en attente"]})]}),b&&(0,a.jsx)("div",{className:"mb-4 rounded-md bg-red-50 p-4 text-red-800",children:b}),"pending"===t&&(0,a.jsxs)(a.Fragment,{children:[x.length>0&&(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h2",{className:"mb-4 text-xl font-semibold text-gray-900",children:"Produits en attente"}),(0,a.jsxs)("div",{className:"overflow-hidden bg-white shadow rounded-lg",children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Produit"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Cr\xe9\xe9 par"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Date"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200 bg-white",children:x.map(G)})]})}),g&&g.total_pages>1&&(0,a.jsxs)("div",{className:"flex items-center justify-between border-t border-gray-200 bg-gray-50 px-6 py-4",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-700",children:["Page ",g.current_page," sur ",g.total_pages," (",g.count," produit(s))"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[g.previous_page&&(0,a.jsx)("button",{onClick:()=>D(g.previous_page),className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Pr\xe9c\xe9dent"}),g.next_page&&(0,a.jsx)("button",{onClick:()=>D(g.next_page),className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Suivant"})]})]})]})]}),h.length>0&&(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h2",{className:"mb-4 text-xl font-semibold text-gray-900",children:"Offres en attente"}),(0,a.jsxs)("div",{className:"overflow-hidden bg-white shadow rounded-lg",children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Produit"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Marchand"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Prix"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Stock"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Cr\xe9\xe9 par"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Date"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200 bg-white",children:h.map(e=>{var t,r,s;return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:(null===(t=e.product)||void 0===t?void 0:t.slug)?(0,a.jsx)(o.default,{href:"/product/".concat(e.product.slug),className:"hover:text-primary",children:e.product.name}):(null===(r=e.product)||void 0===r?void 0:r.name)||"N/A"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(null===(s=e.merchant)||void 0===s?void 0:s.name)||"N/A"}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["number"==typeof e.price?e.price.toFixed(2):parseFloat(String(e.price||0)).toFixed(2)," ",e.currency||"MAD"]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat("in_stock"===e.stock_status?"bg-green-100 text-green-800":"out_of_stock"===e.stock_status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:"in_stock"===e.stock_status?"En stock":"out_of_stock"===e.stock_status?"Rupture":"Stock faible"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.created_by_email||"N/A"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.date_updated?new Date(e.date_updated).toLocaleDateString("fr-FR"):"N/A"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:T===e.id?(0,a.jsxs)("div",{className:"flex flex-col gap-2 items-end",children:[(0,a.jsx)("textarea",{placeholder:"Raison du rejet...",value:C[e.id]||"",onChange:t=>P({...C,[e.id]:t.target.value}),className:"w-full rounded-md border-gray-300 text-sm",rows:2}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>X(e.id),disabled:k===e.id,className:"rounded-md bg-red-600 px-3 py-1 text-xs text-white hover:bg-red-700 disabled:opacity-50",children:k===e.id?"...":"Confirmer"}),(0,a.jsx)("button",{onClick:()=>{L(null),P({...C,[e.id]:""})},className:"rounded-md bg-gray-200 px-3 py-1 text-xs text-gray-700 hover:bg-gray-300",children:"Annuler"})]})]}):(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{onClick:()=>W(e.id),disabled:k===e.id,className:"rounded-md bg-green-600 px-3 py-1 text-xs text-white hover:bg-green-700 disabled:opacity-50",children:k===e.id?"...":"Approuver"}),(0,a.jsx)("button",{onClick:()=>L(e.id),disabled:k===e.id,className:"rounded-md bg-red-600 px-3 py-1 text-xs text-white hover:bg-red-700 disabled:opacity-50",children:"Rejeter"})]})})]},e.id)})})]})}),f&&f.total_pages>1&&(0,a.jsxs)("div",{className:"flex items-center justify-between border-t border-gray-200 bg-gray-50 px-6 py-4",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-700",children:["Page ",f.current_page," sur ",f.total_pages," (",f.count," offre(s))"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[f.previous_page&&(0,a.jsx)("button",{onClick:()=>J(f.previous_page),className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Pr\xe9c\xe9dent"}),f.next_page&&(0,a.jsx)("button",{onClick:()=>J(f.next_page),className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Suivant"})]})]})]})]}),0===x.length&&0===h.length&&!c&&(0,a.jsx)("div",{className:"bg-white p-12 text-center shadow rounded-lg",children:(0,a.jsx)("p",{className:"text-lg text-gray-500",children:"Aucun \xe9l\xe9ment en attente d'approbation"})})]}),"pending"!==t&&(0,a.jsx)(a.Fragment,{children:0===x.length?(0,a.jsx)("div",{className:"bg-white p-12 text-center shadow rounded-lg",children:(0,a.jsx)("p",{className:"text-lg text-gray-500",children:"all"===t?"Aucun produit trouv\xe9":"Aucun produit cr\xe9\xe9"})}):(0,a.jsxs)("div",{className:"overflow-hidden bg-white shadow rounded-lg",children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Produit"}),"all"===t&&(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Statut"}),"my"!==t&&(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Cr\xe9\xe9 par"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Date"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200 bg-white",children:x.map(G)})]})}),g&&g.total_pages>1&&(0,a.jsxs)("div",{className:"flex items-center justify-between border-t border-gray-200 bg-gray-50 px-6 py-4",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-700",children:["Page ",g.current_page," sur ",g.total_pages," (",g.count," ","produit(s) au total)"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[g.previous_page&&(0,a.jsx)("button",{onClick:()=>D(g.previous_page),className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Pr\xe9c\xe9dent"}),g.next_page&&(0,a.jsx)("button",{onClick:()=>D(g.next_page),className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Suivant"})]})]})]})})]})})}function u(){return(0,a.jsx)(c,{})}},3429:function(e,t,r){"use strict";r.d(t,{H:function(){return d},a:function(){return c}});var a=r(7437),s=r(2265),n=r(9988);let l=(0,s.createContext)(void 0),i="primini_auth";function o(e){if(!e){console.warn("getAuthHeader called with null tokens");return}if(e.access){let t={Authorization:"Bearer ".concat(e.access)};return console.log("Using Bearer token for auth"),t}if(e.key){let t={Authorization:"Token ".concat(e.key)};return console.log("Using Token for auth, token length:",e.key.length),t}console.warn("No valid token found in tokens object:",e)}function d(e){let{children:t}=e,[r,d]=function(){let[e,t]=(0,s.useState)(()=>{let e=window.localStorage.getItem(i);if(!e)return console.log("No stored auth tokens found"),null;try{var t;let r=JSON.parse(e);return console.log("Loaded tokens from localStorage:",{hasKey:!!r.key,hasAccess:!!r.access,keyLength:(null===(t=r.key)||void 0===t?void 0:t.length)||0}),r}catch(e){return console.warn("Failed to parse auth tokens",e),null}});return[e,(0,s.useCallback)(e=>{if(t(e),e){var r;console.log("Storing tokens to localStorage:",{hasKey:!!e.key,hasAccess:!!e.access,keyLength:(null===(r=e.key)||void 0===r?void 0:r.length)||0}),window.localStorage.setItem(i,JSON.stringify(e))}else console.log("Clearing tokens from localStorage"),window.localStorage.removeItem(i)},[])]}(),[c,u]=(0,s.useState)(null),[x,p]=(0,s.useState)(!0);(0,s.useEffect)(()=>{!async function(){if(p(!0),!(null==r?void 0:r.access)&&!(null==r?void 0:r.key)){u(null),p(!1);return}try{let e=o(r);console.log("Fetching user on mount/update with headers:",e);let t=await n.Z.get("/auth/user/",{headers:e});console.log("User fetched successfully:",JSON.stringify(t.data,null,2)),console.log("User role from API:",t.data.role);let a={...t.data,role:t.data.role||"visitor"};console.log("Setting user data:",JSON.stringify(a,null,2)),console.log("isAdmin will be:","admin"===a.role),u(a)}catch(r){var e,t,a;console.error("Failed to fetch user profile:",r),console.error("Error response:",null===(e=r.response)||void 0===e?void 0:e.data),console.error("Error status:",null===(t=r.response)||void 0===t?void 0:t.status),(null===(a=r.response)||void 0===a?void 0:a.status)===401&&(d(null),u(null))}finally{p(!1)}}()},[d,r]);let g=(0,s.useCallback)(async(e,t)=>{let r=await n.Z.post("/auth/login/",{email:e,password:t});console.log("Login response:",r.data),console.log("Login response keys:",Object.keys(r.data||{}));let a=r.data,s={key:a.key||a.token||a.token_key,access:a.access,refresh:a.refresh};if(!s.key&&!s.access)throw console.error("No token received in login response:",r.data),console.error("Response structure:",JSON.stringify(r.data,null,2)),Error("Aucun token re\xe7u lors de la connexion. R\xe9ponse: "+JSON.stringify(r.data));console.log("Token extracted successfully:",{hasKey:!!s.key,hasAccess:!!s.access,keyPreview:s.key?s.key.substring(0,10)+"...":"none"}),d(s);try{let e=o(s);console.log("Fetching user with headers:",e);let t=await n.Z.get("/auth/user/",{headers:e});console.log("User response:",JSON.stringify(t.data,null,2)),console.log("User role from API:",t.data.role);let r={...t.data,role:t.data.role||"visitor"};console.log("Setting user data:",JSON.stringify(r,null,2)),u(r)}catch(e){var l,i;throw console.error("Failed to fetch user profile after login:",e),console.error("Error response:",null===(l=e.response)||void 0===l?void 0:l.data),console.error("Error status:",null===(i=e.response)||void 0===i?void 0:i.status),e}},[d]),m=(0,s.useCallback)(async e=>{await n.Z.post("/auth/registration/",e)},[]),h=(0,s.useCallback)(()=>{d(null),u(null)},[d]),y=(0,s.useMemo)(()=>(null==c?void 0:c.role)==="admin",[c]),f=(0,s.useMemo)(()=>(null==c?void 0:c.role)==="client",[c]),v=(0,s.useMemo)(()=>(null==c?void 0:c.role)==="user",[c]),b=(0,s.useMemo)(()=>(null==c?void 0:c.role)==="visitor",[c]),j=(0,s.useMemo)(()=>({user:c,tokens:r,loading:x,isAdmin:y,isClient:f,isUser:v,isVisitor:b,login:g,register:m,logout:h}),[x,g,h,m,r,c,y,f,v,b]);return(0,a.jsx)(l.Provider,{value:j,children:t})}function c(){let e=(0,s.useContext)(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},9988:function(e,t,r){"use strict";var a,s=r(8472),n=r(357);let l=s.Z.create({baseURL:null!==(a=n.env.NEXT_PUBLIC_API_BASE_URL)&&void 0!==a?a:"http://localhost:8000/api",withCredentials:!1});t.Z=l},75:function(e,t,r){"use strict";r.d(t,{BB:function(){return i},Dg:function(){return c},EE:function(){return g},b4:function(){return x},ch:function(){return l},ex:function(){return d},g4:function(){return n},h7:function(){return o},kR:function(){return m},pF:function(){return u},t$:function(){return h},zb:function(){return p}});var a=r(9988);function s(e){return e?{Authorization:"Token ".concat(e)}:{}}async function n(e,t){let r=new FormData;return r.append("file",e),(await a.Z.post("/products/upload_csv/",r,{headers:{...s(t),"Content-Type":"multipart/form-data"}})).data}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2?arguments[2]:void 0,n={page:t.toString()};return r&&(n.approval_status=r),(await a.Z.get("/products/my_products/",{headers:s(e),params:n})).data}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(await a.Z.get("/products/pending/",{headers:s(e),params:{page:t}})).data}async function o(e,t){return(await a.Z.post("/products/".concat(e,"/approve/"),{action:"approve"},{headers:s(t)})).data}async function d(e,t,r){return(await a.Z.post("/products/".concat(e,"/approve/"),{action:"reject",rejection_reason:t},{headers:s(r)})).data}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,l={page:t.toString()};return r&&(l.approval_status=r),n&&(l.search=n),(await a.Z.get("/products/",{headers:s(e),params:l})).data}async function u(){let e=await a.Z.get("/merchants/",{params:{page_size:"1000"}});return Array.isArray(e.data)?e.data:e.data.results||[]}async function x(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return(await a.Z.get("/products/with_description/",{params:{min_length:e,page:t,page_size:r}})).data}async function p(e,t){return(await a.Z.post("/offers/submit/",e,{headers:{Authorization:"Token ".concat(t)}})).data}async function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(await a.Z.get("/offers/pending/",{headers:{Authorization:"Token ".concat(e)},params:{page:t}})).data}async function m(e,t){return(await a.Z.post("/offers/".concat(e,"/approve/"),{},{headers:{Authorization:"Token ".concat(t)}})).data}async function h(e,t,r){return(await a.Z.post("/offers/".concat(e,"/reject/"),{rejection_reason:t},{headers:{Authorization:"Token ".concat(r)}})).data}},7138:function(e,t,r){"use strict";r.d(t,{default:function(){return s.a}});var a=r(231),s=r.n(a)},6463:function(e,t,r){"use strict";var a=r(1169);r.o(a,"notFound")&&r.d(t,{notFound:function(){return a.notFound}}),r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},912:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return s}});let a=r(5592);function s(e){let{reason:t,children:r}=e;if("undefined"==typeof window)throw new a.BailoutToCSRError(t);return r}},1481:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return n}});let a=r(7437),s=r(8512);function n(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let r=(0,s.getExpectedRequestStore)("next/dynamic css"),n=[];if(r.reactLoadableManifest&&t){let e=r.reactLoadableManifest;for(let r of t){if(!e[r])continue;let t=e[r].files.filter(e=>e.endsWith(".css"));n.push(...t)}}return 0===n.length?null:(0,a.jsx)(a.Fragment,{children:n.map(e=>(0,a.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:r.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}}},function(e){e.O(0,[8472,231,2971,7023,1744],function(){return e(e.s=8215)}),_N_E=e.O()}]);