(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5625],{6620:function(e,t,a){Promise.resolve().then(a.bind(a,9127))},9127:function(e,t,a){"use strict";a.d(t,{default:function(){return d}});var r=a(7437),s=a(2265),n=a(3429),l=a(6359);let o={homepage_top:"Page d'accueil - Haut",homepage_middle:"Page d'accueil - Milieu",homepage_bottom:"Page d'accueil - Bas",product_detail_sidebar:"Page produit - Barre lat\xe9rale",product_detail_bottom:"Page produit - Bas",category_page_top:"Page cat\xe9gorie - Haut",search_results_middle:"R\xe9sultats de recherche - Milieu"};function i(e){return e?"string"==typeof e?{ad_type:"adsense",adsense_id:e,banner_image:"",banner_link:""}:{ad_type:e.ad_type||"adsense",adsense_id:e.adsense_id||"",banner_image:e.banner_image||"",banner_link:e.banner_link||""}:{ad_type:"adsense",adsense_id:"",banner_image:"",banner_link:""}}function c(){let{tokens:e}=(0,n.a)(),[t,a]=(0,s.useState)(!0),[c,d]=(0,s.useState)(!1),[u,m]=(0,s.useState)({}),g=(0,s.useRef)({}),[p,h]=(0,s.useState)({enabled:!1,publisher_id:"",homepage_top:"",homepage_middle:"",homepage_bottom:"",product_detail_sidebar:"",product_detail_bottom:"",category_page_top:"",search_results_middle:""}),[y,x]=(0,s.useState)(null);(0,s.useEffect)(()=>{!async function(){try{let e=await (0,l.FD)();h(e)}catch(e){console.error("Failed to load AdSense config",e),x({type:"error",text:"Erreur lors du chargement de la configuration"})}finally{a(!1)}}()},[]);let b=async t=>{if(t.preventDefault(),!(null==e?void 0:e.key)){x({type:"error",text:"Vous devez \xeatre connect\xe9"});return}d(!0),x(null);try{await (0,l.L_)(p,e.key),x({type:"success",text:"Configuration AdSense mise \xe0 jour avec succ\xe8s!"})}catch(e){var a,r;x({type:"error",text:(null===(r=e.response)||void 0===r?void 0:null===(a=r.data)||void 0===a?void 0:a.detail)||"Erreur lors de la mise \xe0 jour"})}finally{d(!1)}},f=(e,t)=>{h(a=>({...a,[e]:t}))},v=(e,t)=>{let a={...i(p[e]),...t};h(t=>({...t,[e]:a}))},_=e=>i(p[e]);return t?(0,r.jsx)("div",{className:"flex items-center justify-center py-20",children:"Chargement..."}):(0,r.jsx)("div",{className:"h-full w-full bg-gray-50 py-8 px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"mx-auto w-full max-w-4xl",children:[(0,r.jsx)("h1",{className:"mb-8 text-3xl font-bold text-gray-900",children:"Configuration Google AdSense"}),y&&(0,r.jsx)("div",{className:"mb-6 rounded-md p-4 ".concat("success"===y.type?"bg-green-50 text-green-800":"bg-red-50 text-red-800"),children:y.text}),(0,r.jsxs)("form",{onSubmit:b,className:"space-y-6 rounded-lg bg-white p-8 shadow",children:[(0,r.jsx)("div",{children:(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",checked:p.enabled,onChange:e=>f("enabled",e.target.checked),className:"mr-2 h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"}),(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Activer Google AdSense"})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Publisher ID (ca-pub-XXXXXXXXXX)"}),(0,r.jsx)("input",{type:"text",value:p.publisher_id,onChange:e=>f("publisher_id",e.target.value),placeholder:"ca-pub-XXXXXXXXXX",className:"mt-1 block w-full rounded-md border-gray-300 px-3 py-2 shadow-sm focus:border-primary focus:ring-primary"}),(0,r.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Trouvez votre Publisher ID dans votre compte Google AdSense (requis pour les publicit\xe9s AdSense)"})]}),(0,r.jsxs)("div",{className:"border-t pt-6",children:[(0,r.jsx)("h2",{className:"mb-4 text-xl font-semibold text-gray-900",children:"Emplacements des publicit\xe9s"}),(0,r.jsx)("p",{className:"mb-6 text-sm text-gray-500",children:"Pour chaque emplacement, vous pouvez choisir entre une publicit\xe9 AdSense ou une banni\xe8re image personnalis\xe9e."}),(0,r.jsx)("div",{className:"space-y-8",children:Object.keys(o).map(t=>{let a=_(t);return(0,r.jsxs)("div",{className:"rounded-lg border border-gray-200 p-6",children:[(0,r.jsx)("h3",{className:"mb-4 text-lg font-medium text-gray-900",children:o[t]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type de publicit\xe9"}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",name:"".concat(t,"_type"),value:"adsense",checked:"adsense"===a.ad_type,onChange:e=>v(t,{ad_type:"adsense"}),className:"mr-2 h-4 w-4 border-gray-300 text-primary focus:ring-primary"}),(0,r.jsx)("span",{className:"text-sm text-gray-700",children:"AdSense ID"})]}),(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",name:"".concat(t,"_type"),value:"banner",checked:"banner"===a.ad_type,onChange:e=>v(t,{ad_type:"banner"}),className:"mr-2 h-4 w-4 border-gray-300 text-primary focus:ring-primary"}),(0,r.jsx)("span",{className:"text-sm text-gray-700",children:"Banni\xe8re Image"})]})]})]}),"adsense"===a.ad_type&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"AdSense Slot ID"}),(0,r.jsx)("input",{type:"text",value:a.adsense_id||"",onChange:e=>v(t,{adsense_id:e.target.value}),placeholder:"ID du slot publicitaire (ex: 1234567890)",className:"mt-1 block w-full rounded-md border-gray-300 px-3 py-2 shadow-sm focus:border-primary focus:ring-primary"}),(0,r.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Laissez vide pour d\xe9sactiver cet emplacement"})]}),"banner"===a.ad_type&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Image de la banni\xe8re"}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("input",{ref:e=>{g.current[t]=e},type:"file",accept:"image/jpeg,image/jpg,image/png,image/gif,image/webp",onChange:async a=>{var r,s,n;let o=null===(r=a.target.files)||void 0===r?void 0:r[0];if(o&&(null==e?void 0:e.key)){m(e=>({...e,[t]:!0}));try{let a=await (0,l.xf)(o,t,e.key);v(t,{banner_image:a.url}),x({type:"success",text:"Image t\xe9l\xe9charg\xe9e avec succ\xe8s!"})}catch(e){x({type:"error",text:(null===(n=e.response)||void 0===n?void 0:null===(s=n.data)||void 0===s?void 0:s.detail)||"Erreur lors du t\xe9l\xe9chargement de l'image"})}finally{m(e=>({...e,[t]:!1}))}}},className:"hidden",id:"file-input-".concat(t)}),(0,r.jsx)("label",{htmlFor:"file-input-".concat(t),className:"flex cursor-pointer items-center justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:u[t]?"T\xe9l\xe9chargement...":"Choisir un fichier"})]}),a.banner_image&&(0,r.jsx)("button",{type:"button",onClick:()=>{v(t,{banner_image:""}),g.current[t]&&(g.current[t].value="")},className:"rounded-md border border-red-300 bg-red-50 px-4 py-2 text-sm font-medium text-red-700 hover:bg-red-100",children:"Supprimer"})]}),(0,r.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Formats accept\xe9s: JPEG, PNG, GIF, WebP (max 5MB)"}),a.banner_image&&(0,r.jsxs)("p",{className:"mt-1 text-xs text-blue-600",children:["Image actuelle: ",a.banner_image]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Lien de destination (optionnel)"}),(0,r.jsx)("input",{type:"url",value:a.banner_link||"",onChange:e=>v(t,{banner_link:e.target.value}),placeholder:"https://example.com",className:"mt-1 block w-full rounded-md border-gray-300 px-3 py-2 shadow-sm focus:border-primary focus:ring-primary"}),(0,r.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"URL vers laquelle rediriger lorsque l'utilisateur clique sur la banni\xe8re"})]}),a.banner_image&&(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("p",{className:"mb-2 text-sm font-medium text-gray-700",children:"Aper\xe7u:"}),(0,r.jsx)("div",{className:"border border-gray-200 rounded-md p-4 bg-gray-50",children:a.banner_link?(0,r.jsx)("a",{href:a.banner_link,target:"_blank",rel:"noopener noreferrer",className:"block",children:(0,r.jsx)("img",{src:a.banner_image,alt:"Banner preview",className:"max-w-full h-auto",onError:e=>{e.target.style.display="none"}})}):(0,r.jsx)("img",{src:a.banner_image,alt:"Banner preview",className:"max-w-full h-auto",onError:e=>{e.target.style.display="none"}})})]})]})]},t)})})]}),(0,r.jsx)("div",{className:"flex justify-end gap-4 pt-6",children:(0,r.jsx)("button",{type:"submit",disabled:c,className:"rounded-md bg-primary px-6 py-2 text-sm font-medium text-white hover:bg-primary/90 disabled:opacity-50",children:c?"Enregistrement...":"Enregistrer la configuration"})})]})]})})}function d(){return(0,r.jsx)(c,{})}},3429:function(e,t,a){"use strict";a.d(t,{H:function(){return c},a:function(){return d}});var r=a(7437),s=a(2265),n=a(9988);let l=(0,s.createContext)(void 0),o="primini_auth";function i(e){if(!e){console.warn("getAuthHeader called with null tokens");return}if(e.access){let t={Authorization:"Bearer ".concat(e.access)};return console.log("Using Bearer token for auth"),t}if(e.key){let t={Authorization:"Token ".concat(e.key)};return console.log("Using Token for auth, token length:",e.key.length),t}console.warn("No valid token found in tokens object:",e)}function c(e){let{children:t}=e,[a,c]=function(){let[e,t]=(0,s.useState)(()=>{let e=window.localStorage.getItem(o);if(!e)return console.log("No stored auth tokens found"),null;try{var t;let a=JSON.parse(e);return console.log("Loaded tokens from localStorage:",{hasKey:!!a.key,hasAccess:!!a.access,keyLength:(null===(t=a.key)||void 0===t?void 0:t.length)||0}),a}catch(e){return console.warn("Failed to parse auth tokens",e),null}});return[e,(0,s.useCallback)(e=>{if(t(e),e){var a;console.log("Storing tokens to localStorage:",{hasKey:!!e.key,hasAccess:!!e.access,keyLength:(null===(a=e.key)||void 0===a?void 0:a.length)||0}),window.localStorage.setItem(o,JSON.stringify(e))}else console.log("Clearing tokens from localStorage"),window.localStorage.removeItem(o)},[])]}(),[d,u]=(0,s.useState)(null),[m,g]=(0,s.useState)(!0);(0,s.useEffect)(()=>{!async function(){if(g(!0),!(null==a?void 0:a.access)&&!(null==a?void 0:a.key)){u(null),g(!1);return}try{let e=i(a);console.log("Fetching user on mount/update with headers:",e);let t=await n.Z.get("/auth/user/",{headers:e});console.log("User fetched successfully:",JSON.stringify(t.data,null,2)),console.log("User role from API:",t.data.role);let r={...t.data,role:t.data.role||"visitor"};console.log("Setting user data:",JSON.stringify(r,null,2)),console.log("isAdmin will be:","admin"===r.role),u(r)}catch(a){var e,t,r;console.error("Failed to fetch user profile:",a),console.error("Error response:",null===(e=a.response)||void 0===e?void 0:e.data),console.error("Error status:",null===(t=a.response)||void 0===t?void 0:t.status),(null===(r=a.response)||void 0===r?void 0:r.status)===401&&(c(null),u(null))}finally{g(!1)}}()},[c,a]);let p=(0,s.useCallback)(async(e,t)=>{let a=await n.Z.post("/auth/login/",{email:e,password:t});console.log("Login response:",a.data),console.log("Login response keys:",Object.keys(a.data||{}));let r=a.data,s={key:r.key||r.token||r.token_key,access:r.access,refresh:r.refresh};if(!s.key&&!s.access)throw console.error("No token received in login response:",a.data),console.error("Response structure:",JSON.stringify(a.data,null,2)),Error("Aucun token re\xe7u lors de la connexion. R\xe9ponse: "+JSON.stringify(a.data));console.log("Token extracted successfully:",{hasKey:!!s.key,hasAccess:!!s.access,keyPreview:s.key?s.key.substring(0,10)+"...":"none"}),c(s);try{let e=i(s);console.log("Fetching user with headers:",e);let t=await n.Z.get("/auth/user/",{headers:e});console.log("User response:",JSON.stringify(t.data,null,2)),console.log("User role from API:",t.data.role);let a={...t.data,role:t.data.role||"visitor"};console.log("Setting user data:",JSON.stringify(a,null,2)),u(a)}catch(e){var l,o;throw console.error("Failed to fetch user profile after login:",e),console.error("Error response:",null===(l=e.response)||void 0===l?void 0:l.data),console.error("Error status:",null===(o=e.response)||void 0===o?void 0:o.status),e}},[c]),h=(0,s.useCallback)(async e=>{await n.Z.post("/auth/registration/",e)},[]),y=(0,s.useCallback)(()=>{c(null),u(null)},[c]),x=(0,s.useMemo)(()=>(null==d?void 0:d.role)==="admin",[d]),b=(0,s.useMemo)(()=>(null==d?void 0:d.role)==="client",[d]),f=(0,s.useMemo)(()=>(null==d?void 0:d.role)==="user",[d]),v=(0,s.useMemo)(()=>(null==d?void 0:d.role)==="visitor",[d]),_=(0,s.useMemo)(()=>({user:d,tokens:a,loading:m,isAdmin:x,isClient:b,isUser:f,isVisitor:v,login:p,register:h,logout:y}),[m,p,y,h,a,d,x,b,f,v]);return(0,r.jsx)(l.Provider,{value:_,children:t})}function d(){let e=(0,s.useContext)(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},9988:function(e,t,a){"use strict";let r=a(8472).Z.create({baseURL:"https://api.azyo6271.odns.fr/api",withCredentials:!1});t.Z=r},6359:function(e,t,a){"use strict";a.d(t,{FD:function(){return s},L_:function(){return l},xf:function(){return n}});var r=a(9988);async function s(){return(await r.Z.get("/settings/adsense_config/")).data}async function n(e,t,a){let s=new FormData;return s.append("file",e),s.append("slot_key",t),(await r.Z.post("/settings/upload_banner_image/",s,{headers:{Authorization:"Token ".concat(a),"Content-Type":"multipart/form-data"}})).data}async function l(e,t){let a={enabled:e.enabled,publisher_id:e.publisher_id};["homepage_top","homepage_middle","homepage_bottom","product_detail_sidebar","product_detail_bottom","category_page_top","search_results_middle"].forEach(t=>{let r=e[t];null==r||""===r?a[t]="":"object"==typeof r&&"ad_type"in r?a[t]=JSON.stringify(r):a[t]=r}),await r.Z.post("/settings/adsense_config/",a,{headers:{Authorization:"Token ".concat(t)}})}}},function(e){e.O(0,[8472,2971,7023,1744],function(){return e(e.s=6620)}),_N_E=e.O()}]);