(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[214],{4892:function(e,t,s){Promise.resolve().then(s.bind(s,2457)),Promise.resolve().then(s.bind(s,912)),Promise.resolve().then(s.bind(s,1481))},2457:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var r=s(7437),a=s(2265),n=s(6463),l=s(3429),i=s(2828),o=s(7138);function c(){let e=(0,n.useRouter)(),t=(0,n.useParams)(),{tokens:s}=(0,l.a)(),c=(null==t?void 0:t.id)?parseInt(t.id):null,[d,u]=(0,a.useState)(!0),[m,x]=(0,a.useState)(null),[h,g]=(0,a.useState)([]),[p,f]=(0,a.useState)(null),[v,y]=(0,a.useState)(null),[j,N]=(0,a.useState)(!1),[b,w]=(0,a.useState)(""),[k,S]=(0,a.useState)(""),[_,P]=(0,a.useState)(null),[A,C]=(0,a.useState)({});(0,a.useEffect)(()=>{(null==s?void 0:s.key)&&c&&(E(),R())},[s,c,b]),(0,a.useEffect)(()=>{_&&clearTimeout(_);let e=setTimeout(()=>{(null==s?void 0:s.key)&&c&&R(1)},500);return P(e),()=>{e&&clearTimeout(e)}},[k]);let E=async()=>{if((null==s?void 0:s.key)&&c){u(!0),y(null);try{let e=await (0,i.M_)(c,s.key);x(e)}catch(s){var e,t;y((null===(t=s.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.detail)||s.message||"Erreur lors du chargement")}finally{u(!1)}}},R=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if((null==s?void 0:s.key)&&c)try{let t=await (0,i.m6)(c,s.key,e,b||void 0,k||void 0);g(t.results),f(t)}catch(e){var t,r;y((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.detail)||e.message||"Erreur lors du chargement des produits")}},O=async()=>{if((null==s?void 0:s.key)&&m){N(!0);try{m.is_active?await (0,i.b8)(m.id,s.key):await (0,i.Sp)(m.id,s.key),await E()}catch(s){var e,t;y((null===(t=s.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.detail)||s.message||"Erreur lors de la modification")}finally{N(!1)}}},F=e=>(0,r.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(e?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e?"Actif":"Inactif"}),L=e=>e?(0,r.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat({pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"}[e]||"bg-gray-100 text-gray-800"),children:{pending:"En attente",approved:"Approuv\xe9",rejected:"Rejet\xe9"}[e]||e}):null;return d?(0,r.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,r.jsx)("div",{className:"text-lg",children:"Chargement..."})}):m?(0,r.jsx)("div",{className:"h-full w-full bg-gray-50 py-8 px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"mx-auto w-full max-w-7xl",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("button",{onClick:()=>e.back(),className:"mb-4 text-sm text-primary hover:text-primary/80",children:"â† Retour \xe0 la liste des utilisateurs"}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:m.first_name||m.last_name?"".concat(m.first_name||""," ").concat(m.last_name||"").trim():m.username||m.email}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:m.email})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[F(m.is_active),(0,r.jsx)("button",{onClick:O,disabled:j||m.is_superuser,className:"rounded-md px-4 py-2 text-sm font-medium text-white ".concat(m.is_active?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"," disabled:opacity-50"),children:j?"...":m.is_active?"D\xe9sactiver":"Activer"})]})]})]}),v&&(0,r.jsx)("div",{className:"mb-4 rounded-md bg-red-50 p-4 text-red-800",children:v}),(0,r.jsx)("div",{className:"mb-6 overflow-hidden bg-white shadow rounded-lg",children:(0,r.jsxs)("div",{className:"px-6 py-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informations utilisateur"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Email"}),(0,r.jsx)("p",{className:"text-sm font-medium",children:m.email})]}),m.username&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Nom d'utilisateur"}),(0,r.jsxs)("p",{className:"text-sm font-medium",children:["@",m.username]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Pr\xe9nom"}),(0,r.jsx)("p",{className:"text-sm font-medium",children:m.first_name||"N/A"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Nom"}),(0,r.jsx)("p",{className:"text-sm font-medium",children:m.last_name||"N/A"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"R\xf4le"}),(0,r.jsx)("p",{className:"text-sm font-medium",children:(0,r.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:"Client"})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Statut"}),(0,r.jsx)("p",{className:"text-sm font-medium",children:F(m.is_active)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Date d'inscription"}),(0,r.jsx)("p",{className:"text-sm font-medium",children:new Date(m.date_joined).toLocaleString("fr-FR")})]}),m.last_login&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Derni\xe8re connexion"}),(0,r.jsx)("p",{className:"text-sm font-medium",children:new Date(m.last_login).toLocaleString("fr-FR")})]})]})]})}),(0,r.jsxs)("div",{className:"overflow-hidden bg-white shadow rounded-lg",children:[(0,r.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["Produits cr\xe9\xe9s (",(null==p?void 0:p.count)||0,")"]})})}),(0,r.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)("input",{type:"text",placeholder:"Rechercher un produit...",value:k,onChange:e=>S(e.target.value),className:"w-full rounded-md border-gray-300 px-3 py-2 text-sm"})}),(0,r.jsxs)("select",{value:b,onChange:e=>{w(e.target.value),R(1)},className:"rounded-md border-gray-300 px-3 py-2 text-sm",children:[(0,r.jsx)("option",{value:"",children:"Tous les statuts"}),(0,r.jsx)("option",{value:"pending",children:"En attente"}),(0,r.jsx)("option",{value:"approved",children:"Approuv\xe9"}),(0,r.jsx)("option",{value:"rejected",children:"Rejet\xe9"})]})]})}),0===h.length?(0,r.jsx)("div",{className:"px-6 py-12 text-center",children:(0,r.jsx)("p",{className:"text-gray-500",children:"Aucun produit trouv\xe9"})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Produit"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Statut d'approbation"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Date de cr\xe9ation"}),(0,r.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500",children:"Actions"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-gray-200 bg-white",children:h.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center",children:[e.image&&!A[e.id]?(0,r.jsx)("img",{src:e.image,alt:e.name,className:"h-12 w-12 rounded object-cover mr-4",onError:()=>C(t=>({...t,[e.id]:!0}))}):(0,r.jsx)("div",{className:"h-12 w-12 rounded bg-gray-200 mr-4 flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-xs text-gray-400",children:"N/A"})}),(0,r.jsxs)("div",{children:[e.slug?(0,r.jsx)(o.default,{href:"/product/".concat(e.slug),className:"text-sm font-medium text-gray-900 hover:text-primary",children:e.name}):(0,r.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.name}),e.brand&&(0,r.jsx)("p",{className:"text-sm text-gray-500",children:e.brand})]})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:L(e.approval_status)}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.created_at?new Date(e.created_at).toLocaleDateString("fr-FR"):"N/A"}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.slug?(0,r.jsx)(o.default,{href:"/product/".concat(e.slug),className:"text-primary hover:text-primary/80",children:"Voir"}):(0,r.jsx)("span",{className:"text-gray-400",children:"N/A"})})]},e.id))})]})}),p&&p.total_pages>1&&(0,r.jsxs)("div",{className:"bg-gray-50 px-6 py-4 flex items-center justify-between border-t border-gray-200",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-700",children:["Page ",p.current_page," sur ",p.total_pages," (",p.count," produit(s) au total)"]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[p.previous_page&&(0,r.jsx)("button",{onClick:()=>R(p.previous_page),className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Pr\xe9c\xe9dent"}),p.next_page&&(0,r.jsx)("button",{onClick:()=>R(p.next_page),className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Suivant"})]})]})]})]})]})}):(0,r.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,r.jsx)("div",{className:"text-lg text-red-600",children:"Utilisateur non trouv\xe9"})})}function d(){return(0,r.jsx)(c,{})}},3429:function(e,t,s){"use strict";s.d(t,{H:function(){return c},a:function(){return d}});var r=s(7437),a=s(2265),n=s(9988);let l=(0,a.createContext)(void 0),i="primini_auth";function o(e){if(!e){console.warn("getAuthHeader called with null tokens");return}if(e.access){let t={Authorization:"Bearer ".concat(e.access)};return console.log("Using Bearer token for auth"),t}if(e.key){let t={Authorization:"Token ".concat(e.key)};return console.log("Using Token for auth, token length:",e.key.length),t}console.warn("No valid token found in tokens object:",e)}function c(e){let{children:t}=e,[s,c]=function(){let[e,t]=(0,a.useState)(()=>{let e=window.localStorage.getItem(i);if(!e)return console.log("No stored auth tokens found"),null;try{var t;let s=JSON.parse(e);return console.log("Loaded tokens from localStorage:",{hasKey:!!s.key,hasAccess:!!s.access,keyLength:(null===(t=s.key)||void 0===t?void 0:t.length)||0}),s}catch(e){return console.warn("Failed to parse auth tokens",e),null}});return[e,(0,a.useCallback)(e=>{if(t(e),e){var s;console.log("Storing tokens to localStorage:",{hasKey:!!e.key,hasAccess:!!e.access,keyLength:(null===(s=e.key)||void 0===s?void 0:s.length)||0}),window.localStorage.setItem(i,JSON.stringify(e))}else console.log("Clearing tokens from localStorage"),window.localStorage.removeItem(i)},[])]}(),[d,u]=(0,a.useState)(null),[m,x]=(0,a.useState)(!0);(0,a.useEffect)(()=>{!async function(){if(x(!0),!(null==s?void 0:s.access)&&!(null==s?void 0:s.key)){u(null),x(!1);return}try{let e=o(s);console.log("Fetching user on mount/update with headers:",e);let t=await n.Z.get("/auth/user/",{headers:e});console.log("User fetched successfully:",JSON.stringify(t.data,null,2)),console.log("User role from API:",t.data.role);let r={...t.data,role:t.data.role||"visitor"};console.log("Setting user data:",JSON.stringify(r,null,2)),console.log("isAdmin will be:","admin"===r.role),u(r)}catch(s){var e,t,r;console.error("Failed to fetch user profile:",s),console.error("Error response:",null===(e=s.response)||void 0===e?void 0:e.data),console.error("Error status:",null===(t=s.response)||void 0===t?void 0:t.status),(null===(r=s.response)||void 0===r?void 0:r.status)===401&&(c(null),u(null))}finally{x(!1)}}()},[c,s]);let h=(0,a.useCallback)(async(e,t)=>{let s=await n.Z.post("/auth/login/",{email:e,password:t});console.log("Login response:",s.data),console.log("Login response keys:",Object.keys(s.data||{}));let r=s.data,a={key:r.key||r.token||r.token_key,access:r.access,refresh:r.refresh};if(!a.key&&!a.access)throw console.error("No token received in login response:",s.data),console.error("Response structure:",JSON.stringify(s.data,null,2)),Error("Aucun token re\xe7u lors de la connexion. R\xe9ponse: "+JSON.stringify(s.data));console.log("Token extracted successfully:",{hasKey:!!a.key,hasAccess:!!a.access,keyPreview:a.key?a.key.substring(0,10)+"...":"none"}),c(a);try{let e=o(a);console.log("Fetching user with headers:",e);let t=await n.Z.get("/auth/user/",{headers:e});console.log("User response:",JSON.stringify(t.data,null,2)),console.log("User role from API:",t.data.role);let s={...t.data,role:t.data.role||"visitor"};console.log("Setting user data:",JSON.stringify(s,null,2)),u(s)}catch(e){var l,i;throw console.error("Failed to fetch user profile after login:",e),console.error("Error response:",null===(l=e.response)||void 0===l?void 0:l.data),console.error("Error status:",null===(i=e.response)||void 0===i?void 0:i.status),e}},[c]),g=(0,a.useCallback)(async e=>{await n.Z.post("/auth/registration/",e)},[]),p=(0,a.useCallback)(()=>{c(null),u(null)},[c]),f=(0,a.useMemo)(()=>(null==d?void 0:d.role)==="admin",[d]),v=(0,a.useMemo)(()=>(null==d?void 0:d.role)==="client",[d]),y=(0,a.useMemo)(()=>(null==d?void 0:d.role)==="user",[d]),j=(0,a.useMemo)(()=>(null==d?void 0:d.role)==="visitor",[d]),N=(0,a.useMemo)(()=>({user:d,tokens:s,loading:m,isAdmin:f,isClient:v,isUser:y,isVisitor:j,login:h,register:g,logout:p}),[m,h,p,g,s,d,f,v,y,j]);return(0,r.jsx)(l.Provider,{value:N,children:t})}function d(){let e=(0,a.useContext)(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},9988:function(e,t,s){"use strict";let r=s(8472).Z.create({baseURL:"http://azyo6271.odns.fr/",withCredentials:!1});t.Z=r},2828:function(e,t,s){"use strict";s.d(t,{AW:function(){return n},M_:function(){return l},Sp:function(){return o},b8:function(){return c},m6:function(){return i}});var r=s(9988);function a(e){return e?{Authorization:"Token ".concat(e)}:{}}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=(arguments.length>2&&arguments[2],arguments.length>3?arguments[3]:void 0),n=arguments.length>4?arguments[4]:void 0,l={page:t.toString()};return void 0!==s&&(l.is_active=s.toString()),n&&(l.search=n),(await r.Z.get("/users/",{headers:a(e),params:l})).data}async function l(e,t){return(await r.Z.get("/users/".concat(e,"/"),{headers:a(t)})).data}async function i(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0,i={page:s.toString()};return n&&(i.approval_status=n),l&&(i.search=l),(await r.Z.get("/users/".concat(e,"/products/"),{headers:a(t),params:i})).data}async function o(e,t){return(await r.Z.post("/users/".concat(e,"/activate/"),{},{headers:a(t)})).data}async function c(e,t){return(await r.Z.post("/users/".concat(e,"/deactivate/"),{},{headers:a(t)})).data}},7138:function(e,t,s){"use strict";s.d(t,{default:function(){return a.a}});var r=s(231),a=s.n(r)},6463:function(e,t,s){"use strict";var r=s(1169);s.o(r,"notFound")&&s.d(t,{notFound:function(){return r.notFound}}),s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},912:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return a}});let r=s(5592);function a(e){let{reason:t,children:s}=e;if("undefined"==typeof window)throw new r.BailoutToCSRError(t);return s}},1481:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return n}});let r=s(7437),a=s(8512);function n(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let s=(0,a.getExpectedRequestStore)("next/dynamic css"),n=[];if(s.reactLoadableManifest&&t){let e=s.reactLoadableManifest;for(let s of t){if(!e[s])continue;let t=e[s].files.filter(e=>e.endsWith(".css"));n.push(...t)}}return 0===n.length?null:(0,r.jsx)(r.Fragment,{children:n.map(e=>(0,r.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:s.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}}},function(e){e.O(0,[8472,231,2971,7023,1744],function(){return e(e.s=4892)}),_N_E=e.O()}]);