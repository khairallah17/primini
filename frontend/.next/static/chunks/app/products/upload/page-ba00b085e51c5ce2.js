(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[948],{2e3:function(e,t,n){Promise.resolve().then(n.bind(n,5275)),Promise.resolve().then(n.bind(n,912)),Promise.resolve().then(n.bind(n,1481))},5275:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var r=n(7437),s=n(2265),o=n(3429),l=n(75),a=n(7138);function i(){let{tokens:e}=(0,o.a)(),[t,n]=(0,s.useState)(null),[i,c]=(0,s.useState)(!1),[u,d]=(0,s.useState)(null),[h,f]=(0,s.useState)(null),p=async r=>{if(r.preventDefault(),!t||!(null==e?void 0:e.key)){d("Veuillez s\xe9lectionner un fichier");return}c(!0),d(null),f(null);try{let r=await (0,l.g4)(t,e.key);f(r),n(null);let s=document.getElementById("csv-file");s&&(s.value="")}catch(e){var s,o;d((null===(o=e.response)||void 0===o?void 0:null===(s=o.data)||void 0===s?void 0:s.detail)||e.message||"Une erreur est survenue lors de l'upload")}finally{c(!1)}};return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,r.jsx)("div",{className:"mx-auto max-w-3xl",children:(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Importer des produits depuis CSV"}),(0,r.jsxs)("div",{className:"mb-6 rounded-md bg-blue-50 p-4 text-blue-800",children:[(0,r.jsx)("h2",{className:"font-semibold mb-2",children:"Format requis (CSV ou Excel):"}),(0,r.jsx)("p",{className:"text-sm mb-2",children:"Le fichier CSV ou Excel (.xlsx, .xls) doit contenir les colonnes suivantes:"}),(0,r.jsxs)("ul",{className:"text-sm list-disc list-inside space-y-1",children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"name"})," (requis) - Nom du produit"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"description"})," - Description du produit"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"brand"})," - Marque"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"category"})," - Nom de la cat\xe9gorie"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"image"})," - URL de l'image"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"price"})," - Prix en MAD"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"merchant"})," - Nom du marchand"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"url"})," - URL du produit"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"tags"})," - Tags s\xe9par\xe9s par des virgules"]})]}),(0,r.jsxs)("p",{className:"text-sm mt-2",children:[(0,r.jsx)("strong",{children:"Note:"})," Les produits cr\xe9\xe9s par les clients n\xe9cessitent une approbation admin."]})]}),u&&(0,r.jsx)("div",{className:"mb-4 rounded-md bg-red-50 p-4 text-red-800",children:u}),h&&(0,r.jsxs)("div",{className:"mb-4 rounded-md bg-green-50 p-4",children:[(0,r.jsx)("div",{className:"font-semibold text-green-800 mb-2",children:h.message}),(0,r.jsxs)("div",{className:"text-sm text-green-700 space-y-1",children:[(0,r.jsxs)("p",{children:["✓ Produits cr\xe9\xe9s: ",h.success]}),(0,r.jsxs)("p",{children:["✓ Approuv\xe9s: ",h.approved]}),(0,r.jsxs)("p",{children:["⏳ En attente: ",h.pending]}),h.total_errors>0&&(0,r.jsxs)("p",{className:"text-red-600",children:["✗ Erreurs: ",h.total_errors]})]}),h.errors.length>0&&(0,r.jsxs)("div",{className:"mt-3 text-sm",children:[(0,r.jsx)("p",{className:"font-semibold text-red-600",children:"Erreurs d\xe9taill\xe9es:"}),(0,r.jsxs)("ul",{className:"list-disc list-inside text-red-600 space-y-1",children:[h.errors.slice(0,10).map((e,t)=>(0,r.jsx)("li",{children:e},t)),h.errors.length>10&&(0,r.jsxs)("li",{children:["... et ",h.errors.length-10," autres erreurs"]})]})]})]}),(0,r.jsxs)("form",{onSubmit:p,className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"csv-file",className:"block text-sm font-medium text-gray-700 mb-2",children:"S\xe9lectionner un fichier CSV"}),(0,r.jsx)("input",{type:"file",id:"csv-file",accept:".csv,.xlsx,.xls",onChange:e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){if(!["csv","xlsx","xls"].includes(r.name.toLowerCase().split(".").pop()||"")){d("Le fichier doit \xeatre un CSV ou Excel (.xlsx, .xls)");return}n(r),d(null),f(null)}},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-primary/90"}),t&&(0,r.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["Fichier s\xe9lectionn\xe9: ",(0,r.jsx)("strong",{children:t.name})," (",(t.size/1024).toFixed(2)," KB)"]})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,r.jsx)(a.default,{href:"/",className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Annuler"}),(0,r.jsx)("button",{type:"submit",disabled:!t||i,className:"rounded-md bg-primary px-4 py-2 text-sm font-medium text-white hover:bg-primary/90 disabled:opacity-50",children:i?"Upload en cours...":"Importer"})]})]})]})})})}function c(){return(0,r.jsx)(i,{})}},3429:function(e,t,n){"use strict";n.d(t,{H:function(){return c},a:function(){return u}});var r=n(7437),s=n(2265),o=n(9988);let l=(0,s.createContext)(void 0),a="primini_auth";function i(e){if(!e){console.warn("getAuthHeader called with null tokens");return}if(e.access){let t={Authorization:"Bearer ".concat(e.access)};return console.log("Using Bearer token for auth"),t}if(e.key){let t={Authorization:"Token ".concat(e.key)};return console.log("Using Token for auth, token length:",e.key.length),t}console.warn("No valid token found in tokens object:",e)}function c(e){let{children:t}=e,[n,c]=function(){let[e,t]=(0,s.useState)(()=>{let e=window.localStorage.getItem(a);if(!e)return console.log("No stored auth tokens found"),null;try{var t;let n=JSON.parse(e);return console.log("Loaded tokens from localStorage:",{hasKey:!!n.key,hasAccess:!!n.access,keyLength:(null===(t=n.key)||void 0===t?void 0:t.length)||0}),n}catch(e){return console.warn("Failed to parse auth tokens",e),null}});return[e,(0,s.useCallback)(e=>{if(t(e),e){var n;console.log("Storing tokens to localStorage:",{hasKey:!!e.key,hasAccess:!!e.access,keyLength:(null===(n=e.key)||void 0===n?void 0:n.length)||0}),window.localStorage.setItem(a,JSON.stringify(e))}else console.log("Clearing tokens from localStorage"),window.localStorage.removeItem(a)},[])]}(),[u,d]=(0,s.useState)(null),[h,f]=(0,s.useState)(!0);(0,s.useEffect)(()=>{!async function(){if(f(!0),!(null==n?void 0:n.access)&&!(null==n?void 0:n.key)){d(null),f(!1);return}try{let e=i(n);console.log("Fetching user on mount/update with headers:",e);let t=await o.Z.get("/auth/user/",{headers:e});console.log("User fetched successfully:",JSON.stringify(t.data,null,2)),console.log("User role from API:",t.data.role);let r={...t.data,role:t.data.role||"visitor"};console.log("Setting user data:",JSON.stringify(r,null,2)),console.log("isAdmin will be:","admin"===r.role),d(r)}catch(n){var e,t,r;console.error("Failed to fetch user profile:",n),console.error("Error response:",null===(e=n.response)||void 0===e?void 0:e.data),console.error("Error status:",null===(t=n.response)||void 0===t?void 0:t.status),(null===(r=n.response)||void 0===r?void 0:r.status)===401&&(c(null),d(null))}finally{f(!1)}}()},[c,n]);let p=(0,s.useCallback)(async(e,t)=>{let n=await o.Z.post("/auth/login/",{email:e,password:t});console.log("Login response:",n.data),console.log("Login response keys:",Object.keys(n.data||{}));let r=n.data,s={key:r.key||r.token||r.token_key,access:r.access,refresh:r.refresh};if(!s.key&&!s.access)throw console.error("No token received in login response:",n.data),console.error("Response structure:",JSON.stringify(n.data,null,2)),Error("Aucun token re\xe7u lors de la connexion. R\xe9ponse: "+JSON.stringify(n.data));console.log("Token extracted successfully:",{hasKey:!!s.key,hasAccess:!!s.access,keyPreview:s.key?s.key.substring(0,10)+"...":"none"}),c(s);try{let e=i(s);console.log("Fetching user with headers:",e);let t=await o.Z.get("/auth/user/",{headers:e});console.log("User response:",JSON.stringify(t.data,null,2)),console.log("User role from API:",t.data.role);let n={...t.data,role:t.data.role||"visitor"};console.log("Setting user data:",JSON.stringify(n,null,2)),d(n)}catch(e){var l,a;throw console.error("Failed to fetch user profile after login:",e),console.error("Error response:",null===(l=e.response)||void 0===l?void 0:l.data),console.error("Error status:",null===(a=e.response)||void 0===a?void 0:a.status),e}},[c]),g=(0,s.useCallback)(async e=>{await o.Z.post("/auth/registration/",e)},[]),m=(0,s.useCallback)(()=>{c(null),d(null)},[c]),x=(0,s.useMemo)(()=>(null==u?void 0:u.role)==="admin",[u]),v=(0,s.useMemo)(()=>(null==u?void 0:u.role)==="client",[u]),y=(0,s.useMemo)(()=>(null==u?void 0:u.role)==="user",[u]),b=(0,s.useMemo)(()=>(null==u?void 0:u.role)==="visitor",[u]),j=(0,s.useMemo)(()=>({user:u,tokens:n,loading:h,isAdmin:x,isClient:v,isUser:y,isVisitor:b,login:p,register:g,logout:m}),[h,p,m,g,n,u,x,v,y,b]);return(0,r.jsx)(l.Provider,{value:j,children:t})}function u(){let e=(0,s.useContext)(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},9988:function(e,t,n){"use strict";var r,s=n(8472),o=n(357);let l=s.Z.create({baseURL:null!==(r=o.env.NEXT_PUBLIC_API_BASE_URL)&&void 0!==r?r:"http://localhost:8000/api",withCredentials:!1});t.Z=l},75:function(e,t,n){"use strict";n.d(t,{BB:function(){return a},Dg:function(){return u},EE:function(){return p},b4:function(){return h},ch:function(){return l},ex:function(){return c},g4:function(){return o},h7:function(){return i},kR:function(){return g},pF:function(){return d},t$:function(){return m},zb:function(){return f}});var r=n(9988);function s(e){return e?{Authorization:"Token ".concat(e)}:{}}async function o(e,t){let n=new FormData;return n.append("file",e),(await r.Z.post("/products/upload_csv/",n,{headers:{...s(t),"Content-Type":"multipart/form-data"}})).data}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,o={page:t.toString()};return n&&(o.approval_status=n),(await r.Z.get("/products/my_products/",{headers:s(e),params:o})).data}async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(await r.Z.get("/products/pending/",{headers:s(e),params:{page:t}})).data}async function i(e,t){return(await r.Z.post("/products/".concat(e,"/approve/"),{action:"approve"},{headers:s(t)})).data}async function c(e,t,n){return(await r.Z.post("/products/".concat(e,"/approve/"),{action:"reject",rejection_reason:t},{headers:s(n)})).data}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,l={page:t.toString()};return n&&(l.approval_status=n),o&&(l.search=o),(await r.Z.get("/products/",{headers:s(e),params:l})).data}async function d(){let e=await r.Z.get("/merchants/",{params:{page_size:"1000"}});return Array.isArray(e.data)?e.data:e.data.results||[]}async function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return(await r.Z.get("/products/with_description/",{params:{min_length:e,page:t,page_size:n}})).data}async function f(e,t){return(await r.Z.post("/offers/submit/",e,{headers:{Authorization:"Token ".concat(t)}})).data}async function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(await r.Z.get("/offers/pending/",{headers:{Authorization:"Token ".concat(e)},params:{page:t}})).data}async function g(e,t){return(await r.Z.post("/offers/".concat(e,"/approve/"),{},{headers:{Authorization:"Token ".concat(t)}})).data}async function m(e,t,n){return(await r.Z.post("/offers/".concat(e,"/reject/"),{rejection_reason:t},{headers:{Authorization:"Token ".concat(n)}})).data}},7138:function(e,t,n){"use strict";n.d(t,{default:function(){return s.a}});var r=n(231),s=n.n(r)},912:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return s}});let r=n(5592);function s(e){let{reason:t,children:n}=e;if("undefined"==typeof window)throw new r.BailoutToCSRError(t);return n}},1481:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return o}});let r=n(7437),s=n(8512);function o(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let n=(0,s.getExpectedRequestStore)("next/dynamic css"),o=[];if(n.reactLoadableManifest&&t){let e=n.reactLoadableManifest;for(let n of t){if(!e[n])continue;let t=e[n].files.filter(e=>e.endsWith(".css"));o.push(...t)}}return 0===o.length?null:(0,r.jsx)(r.Fragment,{children:o.map(e=>(0,r.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:n.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}}},function(e){e.O(0,[8472,231,2971,7023,1744],function(){return e(e.s=2e3)}),_N_E=e.O()}]);