(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2626],{405:function(e,s,t){Promise.resolve().then(t.bind(t,974)),Promise.resolve().then(t.bind(t,912)),Promise.resolve().then(t.bind(t,1481))},974:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return m}});var r=t(7437),o=t(2265),n=t(7138),a=t(6648),i=t(6463),l=t(9343),c=t(1014),u=t(3429),d=t(6453);function m(){let e=(0,i.useRouter)(),{login:s}=(0,u.a)(),[t,m]=(0,o.useState)(null),{register:p,handleSubmit:f,formState:{errors:h,isSubmitting:g}}=(0,l.cI)({resolver:(0,c.F)(d.dm)}),v=async t=>{m(null);try{await s(t.email,t.password),e.push("/")}catch(e){var r;if(console.warn("Failed to login",e),null===(r=e.response)||void 0===r?void 0:r.data){let s=e.response.data,t="",r=(t="string"==typeof s?s:s.detail?s.detail:s.non_field_errors?Array.isArray(s.non_field_errors)?s.non_field_errors[0]:s.non_field_errors:s.email?Array.isArray(s.email)?s.email[0]:s.email:"Identifiants incorrects. Veuillez r\xe9essayer.").toLowerCase();r.includes("inactive")||r.includes("d\xe9sactiv\xe9")||r.includes("non actif")||r.includes("non activ\xe9")?m("Votre compte n'est pas encore activ\xe9. Un administrateur vous contactera d\xe8s que votre compte sera approuv\xe9."):m(t)}else m("Une erreur est survenue. Veuillez r\xe9essayer.")}};return(0,r.jsxs)("div",{className:"grid min-h-svh lg:grid-cols-2",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-4 bg-primary p-4 md:p-6",children:[(0,r.jsx)("div",{className:"flex justify-center gap-2 md:justify-start",children:(0,r.jsx)(n.default,{href:"/",className:"flex items-center gap-2 font-medium",children:(0,r.jsx)(a.default,{src:"/images/avito-colors.jpeg",alt:"Avita",width:120,height:40,className:"h-8 w-auto object-contain",priority:!0})})}),(0,r.jsx)("div",{className:"flex flex-1 items-center justify-center",children:(0,r.jsxs)("div",{className:"w-full max-w-md space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold text-white",children:"Connexion"}),(0,r.jsx)("p",{className:"text-sm text-white/80",children:"Ravi de vous revoir sur Avita"})]}),(0,r.jsxs)("form",{onSubmit:f(v),className:"space-y-4",children:[t&&(0,r.jsx)("div",{className:"rounded-md bg-red-500/20 border border-red-400/50 p-3 text-sm text-red-100",children:t}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-white",htmlFor:"email",children:"Adresse email *"}),(0,r.jsx)("input",{id:"email",type:"email",...p("email"),className:"w-full rounded-lg border border-white/20 bg-white/10 backdrop-blur-sm px-4 py-2.5 text-sm text-white placeholder-white/60 focus:border-white/40 focus:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/30 ".concat(h.email?"border-red-400":""),placeholder:"votre@email.com"}),h.email&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-300",children:h.email.message})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-white",htmlFor:"password",children:"Mot de passe *"}),(0,r.jsx)("input",{id:"password",type:"password",...p("password"),className:"w-full rounded-lg border border-white/20 bg-white/10 backdrop-blur-sm px-4 py-2.5 text-sm text-white placeholder-white/60 focus:border-white/40 focus:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/30 ".concat(h.password?"border-red-400":""),placeholder:"••••••••"}),h.password&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-300",children:h.password.message})]}),(0,r.jsx)("button",{type:"submit",className:"w-full rounded-lg bg-secondary px-4 py-2.5 text-sm font-semibold text-white hover:bg-secondary/90 disabled:opacity-60 disabled:cursor-not-allowed transition-colors shadow-lg",disabled:g,children:g?"Connexion...":"Se connecter"}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)(n.default,{href:"/forgot-password",className:"text-white/80 hover:text-white transition-colors hover:underline",children:"Mot de passe oubli\xe9 ?"}),(0,r.jsx)(n.default,{href:"/register",className:"text-white/80 hover:text-white transition-colors hover:underline",children:"Cr\xe9er un compte"})]})]})]})})]}),(0,r.jsx)("div",{className:"bg-muted relative hidden lg:block",children:(0,r.jsx)(a.default,{src:"https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80",alt:"Cover",fill:!0,className:"object-cover",priority:!0})})]})}},3429:function(e,s,t){"use strict";t.d(s,{H:function(){return c},a:function(){return u}});var r=t(7437),o=t(2265),n=t(9988);let a=(0,o.createContext)(void 0),i="primini_auth";function l(e){if(!e){console.warn("getAuthHeader called with null tokens");return}if(e.access){let s={Authorization:"Bearer ".concat(e.access)};return console.log("Using Bearer token for auth"),s}if(e.key){let s={Authorization:"Token ".concat(e.key)};return console.log("Using Token for auth, token length:",e.key.length),s}console.warn("No valid token found in tokens object:",e)}function c(e){let{children:s}=e,[t,c]=function(){let[e,s]=(0,o.useState)(()=>{let e=window.localStorage.getItem(i);if(!e)return console.log("No stored auth tokens found"),null;try{var s;let t=JSON.parse(e);return console.log("Loaded tokens from localStorage:",{hasKey:!!t.key,hasAccess:!!t.access,keyLength:(null===(s=t.key)||void 0===s?void 0:s.length)||0}),t}catch(e){return console.warn("Failed to parse auth tokens",e),null}});return[e,(0,o.useCallback)(e=>{if(s(e),e){var t;console.log("Storing tokens to localStorage:",{hasKey:!!e.key,hasAccess:!!e.access,keyLength:(null===(t=e.key)||void 0===t?void 0:t.length)||0}),window.localStorage.setItem(i,JSON.stringify(e))}else console.log("Clearing tokens from localStorage"),window.localStorage.removeItem(i)},[])]}(),[u,d]=(0,o.useState)(null),[m,p]=(0,o.useState)(!0);(0,o.useEffect)(()=>{!async function(){if(p(!0),!(null==t?void 0:t.access)&&!(null==t?void 0:t.key)){d(null),p(!1);return}try{let e=l(t);console.log("Fetching user on mount/update with headers:",e);let s=await n.Z.get("/auth/user/",{headers:e});console.log("User fetched successfully:",JSON.stringify(s.data,null,2)),console.log("User role from API:",s.data.role);let r={...s.data,role:s.data.role||"visitor"};console.log("Setting user data:",JSON.stringify(r,null,2)),console.log("isAdmin will be:","admin"===r.role),d(r)}catch(t){var e,s,r;console.error("Failed to fetch user profile:",t),console.error("Error response:",null===(e=t.response)||void 0===e?void 0:e.data),console.error("Error status:",null===(s=t.response)||void 0===s?void 0:s.status),(null===(r=t.response)||void 0===r?void 0:r.status)===401&&(c(null),d(null))}finally{p(!1)}}()},[c,t]);let f=(0,o.useCallback)(async(e,s)=>{let t=await n.Z.post("/auth/login/",{email:e,password:s});console.log("Login response:",t.data),console.log("Login response keys:",Object.keys(t.data||{}));let r=t.data,o={key:r.key||r.token||r.token_key,access:r.access,refresh:r.refresh};if(!o.key&&!o.access)throw console.error("No token received in login response:",t.data),console.error("Response structure:",JSON.stringify(t.data,null,2)),Error("Aucun token re\xe7u lors de la connexion. R\xe9ponse: "+JSON.stringify(t.data));console.log("Token extracted successfully:",{hasKey:!!o.key,hasAccess:!!o.access,keyPreview:o.key?o.key.substring(0,10)+"...":"none"}),c(o);try{let e=l(o);console.log("Fetching user with headers:",e);let s=await n.Z.get("/auth/user/",{headers:e});console.log("User response:",JSON.stringify(s.data,null,2)),console.log("User role from API:",s.data.role);let t={...s.data,role:s.data.role||"visitor"};console.log("Setting user data:",JSON.stringify(t,null,2)),d(t)}catch(e){var a,i;throw console.error("Failed to fetch user profile after login:",e),console.error("Error response:",null===(a=e.response)||void 0===a?void 0:a.data),console.error("Error status:",null===(i=e.response)||void 0===i?void 0:i.status),e}},[c]),h=(0,o.useCallback)(async e=>{await n.Z.post("/auth/registration/",e)},[]),g=(0,o.useCallback)(()=>{c(null),d(null)},[c]),v=(0,o.useMemo)(()=>(null==u?void 0:u.role)==="admin",[u]),x=(0,o.useMemo)(()=>(null==u?void 0:u.role)==="client",[u]),y=(0,o.useMemo)(()=>(null==u?void 0:u.role)==="user",[u]),w=(0,o.useMemo)(()=>(null==u?void 0:u.role)==="visitor",[u]),b=(0,o.useMemo)(()=>({user:u,tokens:t,loading:m,isAdmin:v,isClient:x,isUser:y,isVisitor:w,login:f,register:h,logout:g}),[m,f,g,h,t,u,v,x,y,w]);return(0,r.jsx)(a.Provider,{value:b,children:s})}function u(){let e=(0,o.useContext)(a);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},9988:function(e,s,t){"use strict";var r,o=t(8472),n=t(357);let a=o.Z.create({baseURL:null!==(r=n.env.NEXT_PUBLIC_API_BASE_URL)&&void 0!==r?r:"http://localhost:8000/api",withCredentials:!1});s.Z=a},6453:function(e,s,t){"use strict";t.d(s,{$T:function(){return l},Iy:function(){return o},cU:function(){return i},dm:function(){return n},xj:function(){return c}});var r=t(546);let o=r.Ryn({name:r.Z_8().min(1,"Le nom du produit est requis").min(3,"Le nom doit contenir au moins 3 caract\xe8res").max(200,"Le nom ne peut pas d\xe9passer 200 caract\xe8res"),description:r.Z_8().min(1,"La description est requise").min(500,"La description doit contenir au moins 500 caract\xe8res").max(5e3,"La description ne peut pas d\xe9passer 5000 caract\xe8res"),brand:r.Z_8().max(120,"La marque ne peut pas d\xe9passer 120 caract\xe8res").optional().or(r.i0J("")),category_id:r.G0j([r.Rxh().positive("Cat\xe9gorie invalide"),r.qnd(),r.S1Z()]).transform(e=>"number"!=typeof e||isNaN(e)?void 0:e).optional(),image:r.Z_8().refine(e=>!e||r.Z_8().url().safeParse(e).success,"URL invalide").optional().or(r.i0J("")),tags:r.IXX(r.Z_8().min(1,"Les tags ne peuvent pas \xeatre vides")).max(20,"Maximum 20 tags autoris\xe9s").optional(),specs:r.IMB(r.Z_8(),r.G0j([r.Z_8(),r.Rxh(),r.O72()])).optional(),release_date:r.Z_8().refine(e=>!e||/^\d{4}-\d{2}-\d{2}$/.test(e),"Format de date invalide (YYYY-MM-DD)").optional().or(r.i0J("")),source_category:r.Z_8().max(150,"La cat\xe9gorie source ne peut pas d\xe9passer 150 caract\xe8res").optional().or(r.i0J(""))}),n=r.Ryn({email:r.Z_8().min(1,"L'adresse email est requise").email("Format d'email invalide"),password:r.Z_8().min(1,"Le mot de passe est requis").min(8,"Le mot de passe doit contenir au moins 8 caract\xe8res")}),a=r.Ryn({username:r.Z_8().min(1,"Le nom d'utilisateur est requis").min(3,"Le nom d'utilisateur doit contenir au moins 3 caract\xe8res").max(150,"Le nom d'utilisateur ne peut pas d\xe9passer 150 caract\xe8res").regex(/^[a-zA-Z0-9_]+$/,"Le nom d'utilisateur ne peut contenir que des lettres, chiffres et underscores"),email:r.Z_8().min(1,"L'adresse email est requise").email("Format d'email invalide"),password1:r.Z_8().min(1,"Le mot de passe est requis").min(8,"Le mot de passe doit contenir au moins 8 caract\xe8res").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"Le mot de passe doit contenir au moins une majuscule, une minuscule et un chiffre"),password2:r.Z_8().min(1,"La confirmation du mot de passe est requise"),first_name:r.Z_8().min(1,"Le pr\xe9nom est requis").max(150,"Le pr\xe9nom ne peut pas d\xe9passer 150 caract\xe8res"),last_name:r.Z_8().min(1,"Le nom est requis").max(150,"Le nom ne peut pas d\xe9passer 150 caract\xe8res")}),i=a.extend({enterprise_name:r.Z_8().min(1,"Le nom de l'entreprise est requis").max(200,"Le nom de l'entreprise ne peut pas d\xe9passer 200 caract\xe8res"),address:r.Z_8().min(1,"L'adresse est requise").max(500,"L'adresse ne peut pas d\xe9passer 500 caract\xe8res"),phone_number:r.Z_8().min(1,"Le num\xe9ro de t\xe9l\xe9phone est requis").max(20,"Le num\xe9ro de t\xe9l\xe9phone ne peut pas d\xe9passer 20 caract\xe8res").regex(/^[\d\s\-\+\(\)]+$/,"Le num\xe9ro de t\xe9l\xe9phone contient des caract\xe8res invalides")}).refine(e=>e.password1===e.password2,{message:"Les mots de passe ne correspondent pas",path:["password2"]}),l=a.refine(e=>e.password1===e.password2,{message:"Les mots de passe ne correspondent pas",path:["password2"]});r.Ryn({threshold:r.Z_8().min(1,"Le prix seuil est requis").refine(e=>!isNaN(Number(e))&&Number(e)>0,"Le prix doit \xeatre un nombre positif")});let c=r.Ryn({url:r.Z_8().min(1,"L'URL est requise").url("Format d'URL invalide")});r.Ryn({file:r.PpW(File).refine(e=>e.size<=10485760,"Le fichier ne peut pas d\xe9passer 10MB").refine(e=>e.name.endsWith(".csv"),"Le fichier doit \xeatre un fichier CSV")})},6463:function(e,s,t){"use strict";var r=t(1169);t.o(r,"notFound")&&t.d(s,{notFound:function(){return r.notFound}}),t.o(r,"useParams")&&t.d(s,{useParams:function(){return r.useParams}}),t.o(r,"usePathname")&&t.d(s,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(s,{useSearchParams:function(){return r.useSearchParams}})},912:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"BailoutToCSR",{enumerable:!0,get:function(){return o}});let r=t(5592);function o(e){let{reason:s,children:t}=e;if("undefined"==typeof window)throw new r.BailoutToCSRError(s);return t}},1481:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"PreloadCss",{enumerable:!0,get:function(){return n}});let r=t(7437),o=t(8512);function n(e){let{moduleIds:s}=e;if("undefined"!=typeof window)return null;let t=(0,o.getExpectedRequestStore)("next/dynamic css"),n=[];if(t.reactLoadableManifest&&s){let e=t.reactLoadableManifest;for(let t of s){if(!e[t])continue;let s=e[t].files.filter(e=>e.endsWith(".css"));n.push(...s)}}return 0===n.length?null:(0,r.jsx)(r.Fragment,{children:n.map(e=>(0,r.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:t.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}}},function(e){e.O(0,[8472,231,4974,5981,2971,7023,1744],function(){return e(e.s=405)}),_N_E=e.O()}]);