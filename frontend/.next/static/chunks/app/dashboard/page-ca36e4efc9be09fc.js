(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7702],{8268:function(e,t,r){Promise.resolve().then(r.bind(r,2393)),Promise.resolve().then(r.bind(r,912)),Promise.resolve().then(r.bind(r,1481))},7061:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var n=r(7437),s=r(2265),a=r(6463),o=r(3429);function l(e){let{children:t,requireAuth:r=!1,requireAdmin:l=!1,requireClient:i=!1,requireClientOrAdmin:c=!1,redirectTo:d="/login"}=e,u=(0,a.useRouter)(),{user:p,loading:h,isAdmin:g,isClient:x,isVisitor:m}=(0,o.a)();return((0,s.useEffect)(()=>{if(!h){if(r&&!p){u.push(d);return}if(l&&!g||i&&!x||c&&!x&&!g){u.push("/");return}}},[p,h,g,x,m,r,l,i,c,u,d]),h)?(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,n.jsx)("div",{className:"text-lg",children:"Chargement..."})}):(!r||p)&&(!l||g)&&(!i||x)&&(!c||x||g)?(0,n.jsx)(n.Fragment,{children:t}):null}},2393:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return d}});var n=r(7437),s=r(2265),a=r(7138),o=r(3429),l=r(7061),i=r(75);function c(){let{tokens:e}=(0,o.a)(),[t,r]=(0,s.useState)(!0),[l,c]=(0,s.useState)([]),[d,u]=(0,s.useState)(null),[p,h]=(0,s.useState)(null),[g,x]=(0,s.useState)("all"),[m,f]=(0,s.useState)(!1),[v,y]=(0,s.useState)(null),[j,b]=(0,s.useState)({});(0,s.useEffect)(()=>{(null==e?void 0:e.key)&&w()},[e,g]);let w=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(null==e?void 0:e.key){r(!0),h(null);try{let r=await (0,i.ch)(e.key,t,"all"!==g?g:void 0);c(r.results),u(r)}catch(e){var n,s;h((null===(s=e.response)||void 0===s?void 0:null===(n=s.data)||void 0===n?void 0:n.detail)||e.message||"Erreur lors du chargement des produits")}finally{r(!1)}}},N=async t=>{var r,n,s;let a=null===(r=t.target.files)||void 0===r?void 0:r[0];if(a&&(null==e?void 0:e.key)){if(!["csv","xlsx","xls"].includes(a.name.toLowerCase().split(".").pop()||"")){h("Le fichier doit \xeatre un CSV ou Excel (.xlsx, .xls)");return}f(!0),h(null),y(null);try{let r=await (0,i.g4)(a,e.key);y(r),await w((null==d?void 0:d.current_page)||1),t.target.value=""}catch(e){h((null===(s=e.response)||void 0===s?void 0:null===(n=s.data)||void 0===n?void 0:n.detail)||e.message||"Erreur lors de l'upload")}finally{f(!1)}}},k=e=>({pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"})[e]||"bg-gray-100 text-gray-800",_=e=>({pending:"En attente",approved:"Approuv\xe9",rejected:"Rejet\xe9"})[e]||e,S={total:(null==d?void 0:d.count)||0,pending:l.filter(e=>"pending"===e.approval_status).length,approved:l.filter(e=>"approved"===e.approval_status).length,rejected:l.filter(e=>"rejected"===e.approval_status).length};return t&&0===l.length?(0,n.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,n.jsx)("div",{className:"text-lg",children:"Chargement..."})}):(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,n.jsxs)("div",{className:"mx-auto max-w-7xl",children:[(0,n.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Mon Tableau de bord"}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)(a.default,{href:"/products/create",className:"rounded-md bg-primary px-4 py-2 text-sm font-medium text-white hover:bg-primary/90",children:"+ Cr\xe9er un produit"}),(0,n.jsxs)("label",{className:"cursor-pointer rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700",children:[m?"Upload...":"Importer CSV/Excel",(0,n.jsx)("input",{type:"file",accept:".csv,.xlsx,.xls",onChange:N,className:"hidden",disabled:m})]})]})]}),(0,n.jsxs)("div",{className:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-4",children:[(0,n.jsxs)("div",{className:"rounded-lg bg-white p-4 shadow",children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Total produits"}),(0,n.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:S.total})]}),(0,n.jsxs)("div",{className:"rounded-lg bg-white p-4 shadow",children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"En attente"}),(0,n.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:S.pending})]}),(0,n.jsxs)("div",{className:"rounded-lg bg-white p-4 shadow",children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Approuv\xe9s"}),(0,n.jsx)("p",{className:"text-2xl font-bold text-green-600",children:S.approved})]}),(0,n.jsxs)("div",{className:"rounded-lg bg-white p-4 shadow",children:[(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Rejet\xe9s"}),(0,n.jsx)("p",{className:"text-2xl font-bold text-red-600",children:S.rejected})]})]}),v&&(0,n.jsxs)("div",{className:"mb-4 rounded-md bg-green-50 p-4",children:[(0,n.jsx)("div",{className:"font-semibold text-green-800 mb-2",children:v.message}),(0,n.jsxs)("div",{className:"text-sm text-green-700 space-y-1",children:[(0,n.jsxs)("p",{children:["✓ Produits cr\xe9\xe9s: ",v.success]}),(0,n.jsxs)("p",{children:["✓ Approuv\xe9s: ",v.approved]}),(0,n.jsxs)("p",{children:["⏳ En attente: ",v.pending]}),v.errors.length>0&&(0,n.jsxs)("p",{className:"text-red-600",children:["✗ Erreurs: ",v.errors.length]})]})]}),p&&(0,n.jsx)("div",{className:"mb-4 rounded-md bg-red-50 p-4 text-red-800",children:p}),(0,n.jsxs)("div",{className:"mb-4 flex gap-2",children:[(0,n.jsxs)("button",{onClick:()=>x("all"),className:"rounded-md px-4 py-2 text-sm font-medium ".concat("all"===g?"bg-primary text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:["Tous (",S.total,")"]}),(0,n.jsxs)("button",{onClick:()=>x("pending"),className:"rounded-md px-4 py-2 text-sm font-medium ".concat("pending"===g?"bg-yellow-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:["En attente (",S.pending,")"]}),(0,n.jsxs)("button",{onClick:()=>x("approved"),className:"rounded-md px-4 py-2 text-sm font-medium ".concat("approved"===g?"bg-green-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:["Approuv\xe9s (",S.approved,")"]}),(0,n.jsxs)("button",{onClick:()=>x("rejected"),className:"rounded-md px-4 py-2 text-sm font-medium ".concat("rejected"===g?"bg-red-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"),children:["Rejet\xe9s (",S.rejected,")"]})]}),0===l.length?(0,n.jsxs)("div",{className:"bg-white shadow rounded-lg p-12 text-center",children:[(0,n.jsx)("p",{className:"text-gray-500 text-lg mb-4",children:"Aucun produit trouv\xe9"}),(0,n.jsx)(a.default,{href:"/products/create",className:"inline-block rounded-md bg-primary px-4 py-2 text-sm font-medium text-white hover:bg-primary/90",children:"Cr\xe9er votre premier produit"})]}):(0,n.jsxs)("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produit"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,n.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,n.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,n.jsxs)("div",{className:"flex items-center",children:[e.image&&!j[e.id]?(0,n.jsx)("img",{src:e.image,alt:e.name,className:"h-12 w-12 rounded object-cover mr-4",onError:()=>b(t=>({...t,[e.id]:!0}))}):(0,n.jsx)("div",{className:"h-12 w-12 rounded bg-gray-200 mr-4 flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-xs text-gray-400",children:"N/A"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)(a.default,{href:"/product/".concat(e.slug),className:"text-sm font-medium text-gray-900 hover:text-primary",children:e.name}),e.brand&&(0,n.jsx)("p",{className:"text-sm text-gray-500",children:e.brand})]})]})}),(0,n.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,n.jsx)("span",{className:"inline-flex rounded-full px-2 py-1 text-xs font-semibold ".concat(k(e.approval_status||"pending")),children:_(e.approval_status||"pending")}),"rejected"===e.approval_status&&e.rejection_reason&&(0,n.jsx)("p",{className:"mt-1 text-xs text-red-600",children:e.rejection_reason})]}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.created_at?new Date(e.created_at).toLocaleDateString("fr-FR"):"N/A"}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,n.jsx)(a.default,{href:"/products/".concat(e.slug,"/edit"),className:"text-primary hover:text-primary/80",children:"Modifier"})})]},e.id))})]})}),d&&d.total_pages>1&&(0,n.jsxs)("div",{className:"bg-gray-50 px-6 py-4 flex items-center justify-between border-t border-gray-200",children:[(0,n.jsxs)("div",{className:"text-sm text-gray-700",children:["Page ",d.current_page," sur ",d.total_pages]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[d.previous_page&&(0,n.jsx)("button",{onClick:()=>w(d.previous_page),className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Pr\xe9c\xe9dent"}),d.next_page&&(0,n.jsx)("button",{onClick:()=>w(d.next_page),className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Suivant"})]})]})]})]})})}function d(){return(0,n.jsx)(l.Z,{requireAuth:!0,requireClient:!0,children:(0,n.jsx)(c,{})})}},3429:function(e,t,r){"use strict";r.d(t,{H:function(){return c},a:function(){return d}});var n=r(7437),s=r(2265),a=r(9988);let o=(0,s.createContext)(void 0),l="primini_auth";function i(e){if(!e){console.warn("getAuthHeader called with null tokens");return}if(e.access){let t={Authorization:"Bearer ".concat(e.access)};return console.log("Using Bearer token for auth"),t}if(e.key){let t={Authorization:"Token ".concat(e.key)};return console.log("Using Token for auth, token length:",e.key.length),t}console.warn("No valid token found in tokens object:",e)}function c(e){let{children:t}=e,[r,c]=function(){let[e,t]=(0,s.useState)(()=>{let e=window.localStorage.getItem(l);if(!e)return console.log("No stored auth tokens found"),null;try{var t;let r=JSON.parse(e);return console.log("Loaded tokens from localStorage:",{hasKey:!!r.key,hasAccess:!!r.access,keyLength:(null===(t=r.key)||void 0===t?void 0:t.length)||0}),r}catch(e){return console.warn("Failed to parse auth tokens",e),null}});return[e,(0,s.useCallback)(e=>{if(t(e),e){var r;console.log("Storing tokens to localStorage:",{hasKey:!!e.key,hasAccess:!!e.access,keyLength:(null===(r=e.key)||void 0===r?void 0:r.length)||0}),window.localStorage.setItem(l,JSON.stringify(e))}else console.log("Clearing tokens from localStorage"),window.localStorage.removeItem(l)},[])]}(),[d,u]=(0,s.useState)(null),[p,h]=(0,s.useState)(!0);(0,s.useEffect)(()=>{!async function(){if(h(!0),!(null==r?void 0:r.access)&&!(null==r?void 0:r.key)){u(null),h(!1);return}try{let e=i(r);console.log("Fetching user on mount/update with headers:",e);let t=await a.Z.get("/auth/user/",{headers:e});console.log("User fetched successfully:",JSON.stringify(t.data,null,2)),console.log("User role from API:",t.data.role);let n={...t.data,role:t.data.role||"visitor"};console.log("Setting user data:",JSON.stringify(n,null,2)),console.log("isAdmin will be:","admin"===n.role),u(n)}catch(r){var e,t,n;console.error("Failed to fetch user profile:",r),console.error("Error response:",null===(e=r.response)||void 0===e?void 0:e.data),console.error("Error status:",null===(t=r.response)||void 0===t?void 0:t.status),(null===(n=r.response)||void 0===n?void 0:n.status)===401&&(c(null),u(null))}finally{h(!1)}}()},[c,r]);let g=(0,s.useCallback)(async(e,t)=>{let r=await a.Z.post("/auth/login/",{email:e,password:t});console.log("Login response:",r.data),console.log("Login response keys:",Object.keys(r.data||{}));let n=r.data,s={key:n.key||n.token||n.token_key,access:n.access,refresh:n.refresh};if(!s.key&&!s.access)throw console.error("No token received in login response:",r.data),console.error("Response structure:",JSON.stringify(r.data,null,2)),Error("Aucun token re\xe7u lors de la connexion. R\xe9ponse: "+JSON.stringify(r.data));console.log("Token extracted successfully:",{hasKey:!!s.key,hasAccess:!!s.access,keyPreview:s.key?s.key.substring(0,10)+"...":"none"}),c(s);try{let e=i(s);console.log("Fetching user with headers:",e);let t=await a.Z.get("/auth/user/",{headers:e});console.log("User response:",JSON.stringify(t.data,null,2)),console.log("User role from API:",t.data.role);let r={...t.data,role:t.data.role||"visitor"};console.log("Setting user data:",JSON.stringify(r,null,2)),u(r)}catch(e){var o,l;throw console.error("Failed to fetch user profile after login:",e),console.error("Error response:",null===(o=e.response)||void 0===o?void 0:o.data),console.error("Error status:",null===(l=e.response)||void 0===l?void 0:l.status),e}},[c]),x=(0,s.useCallback)(async e=>{await a.Z.post("/auth/registration/",e)},[]),m=(0,s.useCallback)(()=>{c(null),u(null)},[c]),f=(0,s.useMemo)(()=>(null==d?void 0:d.role)==="admin",[d]),v=(0,s.useMemo)(()=>(null==d?void 0:d.role)==="client",[d]),y=(0,s.useMemo)(()=>(null==d?void 0:d.role)==="user",[d]),j=(0,s.useMemo)(()=>(null==d?void 0:d.role)==="visitor",[d]),b=(0,s.useMemo)(()=>({user:d,tokens:r,loading:p,isAdmin:f,isClient:v,isUser:y,isVisitor:j,login:g,register:x,logout:m}),[p,g,m,x,r,d,f,v,y,j]);return(0,n.jsx)(o.Provider,{value:b,children:t})}function d(){let e=(0,s.useContext)(o);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},9988:function(e,t,r){"use strict";var n,s=r(8472),a=r(357);let o=s.Z.create({baseURL:null!==(n=a.env.NEXT_PUBLIC_API_BASE_URL)&&void 0!==n?n:"http://localhost:8000/api",withCredentials:!1});t.Z=o},75:function(e,t,r){"use strict";r.d(t,{BB:function(){return l},Dg:function(){return d},EE:function(){return g},b4:function(){return p},ch:function(){return o},ex:function(){return c},g4:function(){return a},h7:function(){return i},kR:function(){return x},pF:function(){return u},t$:function(){return m},zb:function(){return h}});var n=r(9988);function s(e){return e?{Authorization:"Token ".concat(e)}:{}}async function a(e,t){let r=new FormData;return r.append("file",e),(await n.Z.post("/products/upload_csv/",r,{headers:{...s(t),"Content-Type":"multipart/form-data"}})).data}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2?arguments[2]:void 0,a={page:t.toString()};return r&&(a.approval_status=r),(await n.Z.get("/products/my_products/",{headers:s(e),params:a})).data}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(await n.Z.get("/products/pending/",{headers:s(e),params:{page:t}})).data}async function i(e,t){return(await n.Z.post("/products/".concat(e,"/approve/"),{action:"approve"},{headers:s(t)})).data}async function c(e,t,r){return(await n.Z.post("/products/".concat(e,"/approve/"),{action:"reject",rejection_reason:t},{headers:s(r)})).data}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,o={page:t.toString()};return r&&(o.approval_status=r),a&&(o.search=a),(await n.Z.get("/products/",{headers:s(e),params:o})).data}async function u(){let e=await n.Z.get("/merchants/",{params:{page_size:"1000"}});return Array.isArray(e.data)?e.data:e.data.results||[]}async function p(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return(await n.Z.get("/products/with_description/",{params:{min_length:e,page:t,page_size:r}})).data}async function h(e,t){return(await n.Z.post("/offers/submit/",e,{headers:{Authorization:"Token ".concat(t)}})).data}async function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(await n.Z.get("/offers/pending/",{headers:{Authorization:"Token ".concat(e)},params:{page:t}})).data}async function x(e,t){return(await n.Z.post("/offers/".concat(e,"/approve/"),{},{headers:{Authorization:"Token ".concat(t)}})).data}async function m(e,t,r){return(await n.Z.post("/offers/".concat(e,"/reject/"),{rejection_reason:t},{headers:{Authorization:"Token ".concat(r)}})).data}},7138:function(e,t,r){"use strict";r.d(t,{default:function(){return s.a}});var n=r(231),s=r.n(n)},6463:function(e,t,r){"use strict";var n=r(1169);r.o(n,"notFound")&&r.d(t,{notFound:function(){return n.notFound}}),r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},912:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return s}});let n=r(5592);function s(e){let{reason:t,children:r}=e;if("undefined"==typeof window)throw new n.BailoutToCSRError(t);return r}},1481:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return a}});let n=r(7437),s=r(8512);function a(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let r=(0,s.getExpectedRequestStore)("next/dynamic css"),a=[];if(r.reactLoadableManifest&&t){let e=r.reactLoadableManifest;for(let r of t){if(!e[r])continue;let t=e[r].files.filter(e=>e.endsWith(".css"));a.push(...t)}}return 0===a.length?null:(0,n.jsx)(n.Fragment,{children:a.map(e=>(0,n.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:r.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}}},function(e){e.O(0,[8472,231,2971,7023,1744],function(){return e(e.s=8268)}),_N_E=e.O()}]);