"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9386],{7061:function(e,t,s){s.d(t,{Z:function(){return a}});var r=s(7437),o=s(2265),n=s(6463),l=s(3429);function a(e){let{children:t,requireAuth:s=!1,requireAdmin:a=!1,requireClient:i=!1,requireClientOrAdmin:c=!1,redirectTo:u="/login"}=e,d=(0,n.useRouter)(),{user:h,loading:f,isAdmin:m,isClient:g,isVisitor:x}=(0,l.a)();return((0,o.useEffect)(()=>{if(!f){if(s&&!h){d.push(u);return}if(a&&!m||i&&!g||c&&!g&&!m){d.push("/");return}}},[h,f,m,g,x,s,a,i,c,d,u]),f)?(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,r.jsx)("div",{className:"text-lg",children:"Chargement..."})}):(!s||h)&&(!a||m)&&(!i||g)&&(!c||g||m)?(0,r.jsx)(r.Fragment,{children:t}):null}},156:function(e,t,s){s.d(t,{Z:function(){return u}});var r=s(7437),o=s(2265),n=s(7138),l=s(6648),a=s(6463),i=s(3429);let c=[{title:"Tableau de bord",href:"/admin",icon:"\uD83D\uDCCA"},{title:"Gestion des produits",items:[{title:"Tous les produits",href:"/admin"},{title:"Cr\xe9er un produit",href:"/products/create"},{title:"Importer CSV",href:"/products/upload"}],icon:"\uD83D\uDCE6"},{title:"Gestion des utilisateurs",href:"/admin/users",icon:"\uD83D\uDC65"},{title:"Configuration AdSense",href:"/admin/adsense",icon:"\uD83D\uDCB0"}];function u(e){var t,s;let{children:u}=e,d=(0,a.usePathname)(),{user:h}=(0,i.a)(),[f,m]=(0,o.useState)(!0),g=e=>"/admin"===e?"/admin"===d:"/admin/users"===e?d.startsWith("/admin/users"):d.startsWith(e);return(0,r.jsxs)("div",{className:"flex h-screen w-full overflow-hidden bg-gray-50",children:[(0,r.jsxs)("aside",{className:"".concat(f?"w-64":"w-20"," fixed left-0 top-0 z-50 h-screen bg-primary border-r border-primary-dark/30 transition-all duration-300 flex flex-col shadow-lg"),children:[(0,r.jsxs)("div",{className:"flex h-24 items-center justify-between border-b border-primary-dark/30 px-4",children:[(0,r.jsx)(n.default,{href:"/",className:"flex items-center ".concat(f?"justify-start":"justify-center"," flex-1"),children:(0,r.jsx)(l.default,{src:"/images/avito-colors.jpeg",alt:"Avita",width:f?180:50,height:f?60:50,className:"".concat(f?"h-16 w-auto":"h-12 w-12"," object-contain transition-all"),priority:!0})}),(0,r.jsx)("button",{onClick:()=>m(!f),className:"rounded-md p-2 text-white/80 hover:bg-primary-dark/30 hover:text-white transition-colors","aria-label":"Toggle sidebar",children:f?(0,r.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):(0,r.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]}),(0,r.jsx)("nav",{className:"flex-1 overflow-y-auto px-3 py-4",children:(0,r.jsx)("ul",{className:"space-y-1",children:c.map((e,t)=>e.items?(0,r.jsxs)("li",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 px-3 py-2 text-sm font-medium text-white/90 ".concat(!f&&"justify-center"),children:[(0,r.jsx)("span",{className:"text-lg",children:e.icon}),f&&(0,r.jsx)("span",{children:e.title})]}),f&&(0,r.jsx)("ul",{className:"ml-6 mt-1 space-y-1",children:e.items.map(e=>(0,r.jsx)("li",{children:(0,r.jsx)(n.default,{href:e.href,className:"block rounded-md px-3 py-2 text-sm transition-colors ".concat(g(e.href)?"bg-white/20 text-white font-medium":"text-white/70 hover:bg-white/10 hover:text-white"),children:e.title})},e.href))})]},t):(0,r.jsx)("li",{children:(0,r.jsxs)(n.default,{href:e.href,className:"flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors ".concat(g(e.href)?"bg-white/20 text-white":"text-white/80 hover:bg-white/10 hover:text-white"," ").concat(!f&&"justify-center"),children:[(0,r.jsx)("span",{className:"text-lg",children:e.icon}),f&&(0,r.jsx)("span",{children:e.title})]})},e.href))})}),f&&h&&(0,r.jsx)("div",{className:"border-t border-primary-dark/30 p-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-white/20 text-white font-semibold",children:((null===(t=h.first_name)||void 0===t?void 0:t[0])||(null===(s=h.username)||void 0===s?void 0:s[0])||h.email[0]||"U").toUpperCase()}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"truncate text-sm font-medium text-white",children:h.first_name&&h.last_name?"".concat(h.first_name," ").concat(h.last_name):h.username||h.email}),(0,r.jsx)("p",{className:"truncate text-xs text-white/70",children:h.email})]})]})})]}),(0,r.jsx)("div",{className:"flex-1 w-full h-screen overflow-y-auto transition-all duration-300 ".concat(f?"ml-64":"ml-20"),style:{marginTop:0},children:(0,r.jsx)("div",{className:"h-full w-full",children:u})})]})}},3429:function(e,t,s){s.d(t,{H:function(){return c},a:function(){return u}});var r=s(7437),o=s(2265),n=s(9988);let l=(0,o.createContext)(void 0),a="primini_auth";function i(e){if(!e){console.warn("getAuthHeader called with null tokens");return}if(e.access){let t={Authorization:"Bearer ".concat(e.access)};return console.log("Using Bearer token for auth"),t}if(e.key){let t={Authorization:"Token ".concat(e.key)};return console.log("Using Token for auth, token length:",e.key.length),t}console.warn("No valid token found in tokens object:",e)}function c(e){let{children:t}=e,[s,c]=function(){let[e,t]=(0,o.useState)(()=>{let e=window.localStorage.getItem(a);if(!e)return console.log("No stored auth tokens found"),null;try{var t;let s=JSON.parse(e);return console.log("Loaded tokens from localStorage:",{hasKey:!!s.key,hasAccess:!!s.access,keyLength:(null===(t=s.key)||void 0===t?void 0:t.length)||0}),s}catch(e){return console.warn("Failed to parse auth tokens",e),null}});return[e,(0,o.useCallback)(e=>{if(t(e),e){var s;console.log("Storing tokens to localStorage:",{hasKey:!!e.key,hasAccess:!!e.access,keyLength:(null===(s=e.key)||void 0===s?void 0:s.length)||0}),window.localStorage.setItem(a,JSON.stringify(e))}else console.log("Clearing tokens from localStorage"),window.localStorage.removeItem(a)},[])]}(),[u,d]=(0,o.useState)(null),[h,f]=(0,o.useState)(!0);(0,o.useEffect)(()=>{!async function(){if(f(!0),!(null==s?void 0:s.access)&&!(null==s?void 0:s.key)){d(null),f(!1);return}try{let e=i(s);console.log("Fetching user on mount/update with headers:",e);let t=await n.Z.get("/auth/user/",{headers:e});console.log("User fetched successfully:",JSON.stringify(t.data,null,2)),console.log("User role from API:",t.data.role);let r={...t.data,role:t.data.role||"visitor"};console.log("Setting user data:",JSON.stringify(r,null,2)),console.log("isAdmin will be:","admin"===r.role),d(r)}catch(s){var e,t,r;console.error("Failed to fetch user profile:",s),console.error("Error response:",null===(e=s.response)||void 0===e?void 0:e.data),console.error("Error status:",null===(t=s.response)||void 0===t?void 0:t.status),(null===(r=s.response)||void 0===r?void 0:r.status)===401&&(c(null),d(null))}finally{f(!1)}}()},[c,s]);let m=(0,o.useCallback)(async(e,t)=>{let s=await n.Z.post("/auth/login/",{email:e,password:t});console.log("Login response:",s.data),console.log("Login response keys:",Object.keys(s.data||{}));let r=s.data,o={key:r.key||r.token||r.token_key,access:r.access,refresh:r.refresh};if(!o.key&&!o.access)throw console.error("No token received in login response:",s.data),console.error("Response structure:",JSON.stringify(s.data,null,2)),Error("Aucun token re\xe7u lors de la connexion. R\xe9ponse: "+JSON.stringify(s.data));console.log("Token extracted successfully:",{hasKey:!!o.key,hasAccess:!!o.access,keyPreview:o.key?o.key.substring(0,10)+"...":"none"}),c(o);try{let e=i(o);console.log("Fetching user with headers:",e);let t=await n.Z.get("/auth/user/",{headers:e});console.log("User response:",JSON.stringify(t.data,null,2)),console.log("User role from API:",t.data.role);let s={...t.data,role:t.data.role||"visitor"};console.log("Setting user data:",JSON.stringify(s,null,2)),d(s)}catch(e){var l,a;throw console.error("Failed to fetch user profile after login:",e),console.error("Error response:",null===(l=e.response)||void 0===l?void 0:l.data),console.error("Error status:",null===(a=e.response)||void 0===a?void 0:a.status),e}},[c]),g=(0,o.useCallback)(async e=>{await n.Z.post("/auth/registration/",e)},[]),x=(0,o.useCallback)(()=>{c(null),d(null)},[c]),p=(0,o.useMemo)(()=>(null==u?void 0:u.role)==="admin",[u]),v=(0,o.useMemo)(()=>(null==u?void 0:u.role)==="client",[u]),y=(0,o.useMemo)(()=>(null==u?void 0:u.role)==="user",[u]),w=(0,o.useMemo)(()=>(null==u?void 0:u.role)==="visitor",[u]),k=(0,o.useMemo)(()=>({user:u,tokens:s,loading:h,isAdmin:p,isClient:v,isUser:y,isVisitor:w,login:m,register:g,logout:x}),[h,m,x,g,s,u,p,v,y,w]);return(0,r.jsx)(l.Provider,{value:k,children:t})}function u(){let e=(0,o.useContext)(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},9988:function(e,t,s){var r,o=s(8472),n=s(357);let l=o.Z.create({baseURL:null!==(r=n.env.NEXT_PUBLIC_API_BASE_URL)&&void 0!==r?r:"http://localhost:8000/api",withCredentials:!1});t.Z=l},6463:function(e,t,s){var r=s(1169);s.o(r,"notFound")&&s.d(t,{notFound:function(){return r.notFound}}),s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})}}]);