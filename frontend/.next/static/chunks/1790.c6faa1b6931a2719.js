"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1790],{1790:function(e,s,t){t.r(s),t.d(s,{default:function(){return N}});var a=t(7437),l=t(2265),r=t(7138),n=t(2731),o=t(3429),i=t(8618),c=t(9988),d=t(6359),m=t(75),x=t(1279),u=t(2068),h=t(1400);function p(e){let{children:s}=e,t=(0,l.useRef)(null),r=e=>{let s=t.current;if(!s)return;let a=.8*s.clientWidth;s.scrollBy({left:"left"===e?-a:a,behavior:"smooth"})};return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{ref:t,className:"flex snap-x snap-mandatory gap-4 overflow-x-auto pb-4",children:s}),(0,a.jsx)("button",{onClick:()=>r("left"),className:"absolute left-0 top-1/2 -translate-y-1/2 rounded-full bg-white p-2 shadow-lg",type:"button","aria-label":"Pr\xe9c\xe9dent",children:(0,a.jsx)(u.Z,{className:"h-5 w-5 text-primary"})}),(0,a.jsx)("button",{onClick:()=>r("right"),className:"absolute right-0 top-1/2 -translate-y-1/2 rounded-full bg-white p-2 shadow-lg",type:"button","aria-label":"Suivant",children:(0,a.jsx)(h.Z,{className:"h-5 w-5 text-primary"})})]})}var f=t(6847),g=t(7977),b=t(6648);let v=(0,l.forwardRef)((e,s)=>{let{images:t,productName:r}=e,[n,o]=(0,l.useState)(0),[i,c]=(0,l.useState)({}),d=e=>{c(s=>({...s,[e]:!0}))};if(0===t.length)return(0,a.jsx)("div",{ref:s,className:"w-full flex flex-col items-center",children:(0,a.jsx)("div",{className:"relative aspect-[4/3] w-full max-w-md sm:max-w-lg md:max-w-xl lg:max-w-2xl flex items-center justify-center overflow-hidden rounded-2xl bg-gradient-to-br from-slate-100 to-slate-200",children:(0,a.jsx)("span",{className:"text-sm font-medium text-slate-400",children:"Image non disponible"})})});let m=t[n]||t[0],x=i[n];return(0,a.jsxs)("div",{ref:s,className:"w-full flex flex-col items-center",children:[(0,a.jsx)("div",{className:"relative aspect-[4/3] w-full max-w-full sm:max-w-lg md:max-w-xl lg:max-w-2xl overflow-hidden rounded-xl sm:rounded-2xl bg-slate-100 mb-3 sm:mb-4 group",children:m&&!x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"absolute inset-2 sm:inset-3 md:inset-4 lg:inset-6",children:(0,a.jsx)(b.default,{src:m,alt:r,fill:!0,className:"object-contain transition-opacity duration-300",sizes:"(max-width: 640px) 100vw, (max-width: 768px) 28rem, (max-width: 1024px) 32rem, 36rem",quality:95,priority:0===n,placeholder:"blur",blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mN8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==",onError:()=>d(n),unoptimized:!0})}),t.length>1&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{type:"button",onClick:()=>{o(e=>(e-1+t.length)%t.length)},className:"absolute left-2 sm:left-3 md:left-4 top-1/2 -translate-y-1/2 bg-white/90 hover:bg-white active:bg-white rounded-full p-1.5 sm:p-2 shadow-lg transition-all opacity-100 sm:opacity-0 sm:group-hover:opacity-100 focus:opacity-100 z-10","aria-label":"Image pr\xe9c\xe9dente",children:(0,a.jsx)("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-800",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,a.jsx)("button",{type:"button",onClick:()=>{o(e=>(e+1)%t.length)},className:"absolute right-2 sm:right-3 md:right-4 top-1/2 -translate-y-1/2 bg-white/90 hover:bg-white active:bg-white rounded-full p-1.5 sm:p-2 shadow-lg transition-all opacity-100 sm:opacity-0 sm:group-hover:opacity-100 focus:opacity-100 z-10","aria-label":"Image suivante",children:(0,a.jsx)("svg",{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-800",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),(0,a.jsxs)("div",{className:"absolute bottom-2 sm:bottom-3 md:bottom-4 left-1/2 -translate-x-1/2 bg-black/60 text-white px-2 sm:px-3 py-0.5 sm:py-1 rounded-full text-xs sm:text-sm",children:[n+1," / ",t.length]})]})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("span",{className:"text-xs sm:text-sm font-medium text-slate-400",children:"Image non disponible"})})}),t.length>1&&(0,a.jsx)("div",{className:"w-full max-w-full sm:max-w-lg md:max-w-xl lg:max-w-2xl",children:(0,a.jsx)("div",{className:"w-full overflow-x-auto scrollbar-hide snap-x snap-mandatory scroll-smooth touch-pan-x",children:(0,a.jsx)("div",{className:"inline-flex gap-2 sm:gap-2.5 md:gap-3 pb-2 px-1 sm:px-2",children:t.map((e,s)=>{let t=s===n,l=i[s];return(0,a.jsx)("button",{type:"button",onClick:()=>o(s),className:"relative flex-shrink-0 w-14 h-14 sm:w-16 sm:h-16 md:w-20 md:h-20 lg:w-24 lg:h-24 rounded-lg overflow-hidden border-2 transition-all snap-start ".concat(t?"border-primary ring-2 ring-primary/20 scale-105 shadow-md":"border-slate-200 hover:border-slate-300 hover:scale-105 active:scale-95"),"aria-label":"Voir l'image ".concat(s+1),children:e&&!l?(0,a.jsx)(b.default,{src:e,alt:"".concat(r," - Vue ").concat(s+1),fill:!0,className:"object-cover",sizes:"(max-width: 640px) 56px, (max-width: 768px) 64px, (max-width: 1024px) 80px, 96px",quality:75,loading:"lazy",onError:()=>d(s),unoptimized:!0}):(0,a.jsx)("div",{className:"w-full h-full bg-slate-200 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-[10px] sm:text-xs text-slate-400",children:"N/A"})})},s)})})})})]})});function j(){return(0,a.jsxs)("div",{className:"space-y-6 md:space-y-8",children:[(0,a.jsxs)("nav",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"h-4 w-16 animate-pulse rounded bg-slate-200"}),(0,a.jsx)("span",{className:"text-slate-400",children:"/"}),(0,a.jsx)("div",{className:"h-4 w-24 animate-pulse rounded bg-slate-200"}),(0,a.jsx)("span",{className:"text-slate-400",children:"/"}),(0,a.jsx)("div",{className:"h-4 w-32 animate-pulse rounded bg-slate-200"})]}),(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 space-y-3",children:[(0,a.jsx)("div",{className:"h-10 w-3/4 animate-pulse rounded bg-slate-200 md:h-12"}),(0,a.jsx)("div",{className:"h-6 w-1/3 animate-pulse rounded bg-slate-200"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("div",{className:"h-10 w-24 animate-pulse rounded-lg bg-slate-200"}),(0,a.jsx)("div",{className:"h-10 w-20 animate-pulse rounded-lg bg-slate-200"})]})]})}),(0,a.jsxs)("div",{className:"grid gap-8 lg:grid-cols-[1fr,1.2fr]",children:[(0,a.jsxs)("div",{className:"w-full flex flex-col items-center",children:[(0,a.jsx)("div",{className:"relative aspect-[4/3] w-full max-w-md sm:max-w-lg md:max-w-xl lg:max-w-2xl overflow-hidden rounded-2xl bg-slate-200 mb-4 animate-pulse",children:(0,a.jsx)("div",{className:"absolute inset-4 md:inset-6",children:(0,a.jsx)("div",{className:"h-full w-full bg-slate-300 rounded"})})}),(0,a.jsx)("div",{className:"w-full max-w-md sm:max-w-lg md:max-w-xl lg:max-w-2xl",children:(0,a.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[1,2,3,4].map(e=>(0,a.jsx)("div",{className:"flex-shrink-0 w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 rounded-lg bg-slate-200 animate-pulse"},e))})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"h-6 w-32 animate-pulse rounded bg-slate-200"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"h-4 w-full animate-pulse rounded bg-slate-200"}),(0,a.jsx)("div",{className:"h-4 w-full animate-pulse rounded bg-slate-200"}),(0,a.jsx)("div",{className:"h-4 w-5/6 animate-pulse rounded bg-slate-200"})]})]}),(0,a.jsx)("div",{className:"h-8 w-40 animate-pulse rounded bg-slate-200"})]})]}),(0,a.jsx)("div",{className:"border-b border-slate-200",children:(0,a.jsxs)("div",{className:"flex gap-6",children:[(0,a.jsx)("div",{className:"h-10 w-20 animate-pulse rounded bg-slate-200"}),(0,a.jsx)("div",{className:"h-10 w-24 animate-pulse rounded bg-slate-200"})]})}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"h-5 w-5 animate-pulse rounded bg-slate-200"}),(0,a.jsx)("div",{className:"h-5 w-64 animate-pulse rounded bg-slate-200"})]}),(0,a.jsx)("div",{className:"space-y-4",children:[1,2,3,4,5].map(e=>(0,a.jsx)("div",{className:"border border-slate-200 rounded-lg p-4 animate-pulse",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 space-y-3",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("div",{className:"h-6 w-24 animate-pulse rounded bg-slate-200"})}),(0,a.jsx)("div",{className:"h-4 w-3/4 animate-pulse rounded bg-slate-200"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[(0,a.jsx)("div",{className:"h-4 w-20 animate-pulse rounded bg-slate-200"}),(0,a.jsx)("div",{className:"h-6 w-32 animate-pulse rounded bg-slate-200"}),(0,a.jsx)("div",{className:"h-4 w-24 animate-pulse rounded bg-slate-200"})]})]}),(0,a.jsx)("div",{className:"h-10 w-32 animate-pulse rounded-lg bg-slate-200"})]})},e))})]}),(0,a.jsxs)("section",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"h-8 w-48 animate-pulse rounded bg-slate-200"}),(0,a.jsx)("div",{className:"flex gap-4 overflow-x-auto pb-4",children:[1,2,3,4].map(e=>(0,a.jsx)("div",{className:"min-w-[250px] sm:min-w-[280px] h-96 animate-pulse rounded-3xl bg-slate-200"},e))})]})]})}function y(e){if(null==e)return"N/A";let s="string"==typeof e?parseFloat(e):e;return isNaN(s)?"N/A":"".concat(s.toFixed(3)," MAD")}function N(e){var s;let{slug:t}=e,[u,h]=(0,l.useState)(null),[b,N]=(0,l.useState)(!0),[w,k]=(0,l.useState)(null),[_,A]=(0,l.useState)(!1),[S,C]=(0,l.useState)(!1),[E,M]=(0,l.useState)("price"),[F,P]=(0,l.useState)(!1),[D,I]=(0,l.useState)([]),[z,L]=(0,l.useState)(!1),[O,R]=(0,l.useState)(null),[U,J]=(0,l.useState)({product_slug:t,price:0,stock_status:"in_stock",currency:"MAD"}),[Z,V]=(0,l.useState)([]),[q,B]=(0,l.useState)(!1),T=(0,l.useRef)(null),{addFavorite:H,isFavorite:G,removeFavorite:K}=(0,i.r)(),{tokens:W,user:Q,isAdmin:Y}=(0,o.a)();(0,l.useEffect)(()=>{(async function(){try{let e=await c.Z.get("/products/".concat(t,"/"));h(e.data)}catch(e){console.warn("Failed to load product",e)}finally{N(!1)}})()},[t]),(0,l.useEffect)(()=>{(async function(){try{let e=await (0,d.FD)();k(e)}catch(e){console.warn("Failed to load AdSense config",e)}})()},[]),(0,l.useEffect)(()=>{(async function(){try{let e=await (0,m.pF)();I(e)}catch(e){console.warn("Failed to load merchants",e)}})()},[]),(0,l.useEffect)(()=>{(async function(){var e,s;if(!u)return;let t=null===(e=u.category)||void 0===e?void 0:e.slug;if(t){B(!0);try{let e={page_size:20};(null===(s=u.subcategory)||void 0===s?void 0:s.slug)&&(e.subcategory=u.subcategory.slug);let a=(await (0,x.R)(t,e)).results.filter(e=>e.id!==u.id).slice(0,12);V(a)}catch(e){console.warn("Failed to load similar products",e),V([])}finally{B(!1)}}})()},[u]);let X=async e=>{var s,a,l;if(e.preventDefault(),!(null==W?void 0:W.key)||!Q){R({type:"error",text:"Vous devez \xeatre connect\xe9 pour soumettre une offre"});return}if(!U.merchant_id&&!(null===(s=U.merchant_name)||void 0===s?void 0:s.trim())){R({type:"error",text:"Veuillez s\xe9lectionner ou saisir un nom de marchand"});return}if(U.price<=0){R({type:"error",text:"Le prix doit \xeatre sup\xe9rieur \xe0 0"});return}L(!0),R(null);try{await (0,m.zb)(U,W.key),R({type:"success",text:"Offre soumise avec succ\xe8s! Elle sera examin\xe9e par un administrateur avant d'\xeatre publi\xe9e."}),J({product_slug:t,price:0,stock_status:"in_stock",currency:"MAD"}),P(!1);let e=await c.Z.get("/products/".concat(t,"/"));h(e.data)}catch(e){R({type:"error",text:(null===(l=e.response)||void 0===l?void 0:null===(a=l.data)||void 0===a?void 0:a.detail)||"Erreur lors de la soumission de l'offre"})}finally{L(!1)}},$=(0,l.useMemo)(()=>{var e;let s=null!==(e=null==u?void 0:u.offers)&&void 0!==e?e:[];return S?s.filter(e=>"in_stock"===e.stock_status):s},[null==u?void 0:u.offers,S]),ee=$.length>0?Math.min(...$.map(e=>Number(e.price))):void 0,es=$.length>0?Math.max(...$.map(e=>Number(e.price))):void 0,et=!!u&&G(u.id),ea=$.length>5,el=ea&&!_?$.slice(0,5):$,er=u&&Q&&(Y||u.created_by_email===Q.email&&"approved"!==u.approval_status),en=(0,l.useMemo)(()=>{if(!(null==u?void 0:u.category))return[];let e=[{name:"Start",slug:"/"}];return e.push({name:u.category.name,slug:"/categories/".concat(u.category.slug)}),e},[null==u?void 0:u.category]);return b?(0,a.jsx)(j,{}):u?(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6 md:space-y-8",children:[(0,a.jsx)("nav",{className:"flex items-center gap-1 sm:gap-2 text-xs sm:text-sm text-slate-600 overflow-x-auto",children:en.map((e,s)=>(0,a.jsxs)("span",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[s>0&&(0,a.jsx)("span",{children:"/"}),e.slug?(0,a.jsx)(r.default,{href:e.slug,className:"hover:text-primary transition-colors whitespace-nowrap",children:e.name}):(0,a.jsx)("span",{className:"whitespace-nowrap",children:e.name})]},s))}),(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h1",{className:"text-xl sm:text-2xl md:text-3xl lg:text-4xl font-bold text-slate-900 break-words",children:u.name}),u.brand&&(0,a.jsx)("p",{className:"mt-2 text-base sm:text-lg text-slate-600",children:u.brand})]}),(0,a.jsxs)("div",{className:"flex gap-2 flex-shrink-0",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{u&&(et?K(u.id):H({id:u.id,name:u.name,slug:u.slug,image:u.image,lowestPrice:ee}))},className:"px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium rounded-lg transition-colors whitespace-nowrap ".concat(et?"bg-secondary text-white hover:bg-secondary/90":"bg-slate-200 text-slate-700 hover:bg-slate-300"),children:et?"Retirer":"Ajouter"}),er&&(0,a.jsx)(r.default,{href:"/products/".concat(u.slug,"/edit"),className:"px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors whitespace-nowrap",children:"Modifier"})]})]})}),(0,a.jsxs)("div",{className:"grid gap-6 sm:gap-8 lg:grid-cols-[1fr,1.2fr] lg:items-start",children:[(0,a.jsx)("div",{className:"w-full order-1",children:(0,a.jsx)(v,{images:u.images&&u.images.length>0?u.images.sort((e,s)=>e.order-s.order).map(e=>e.image_url||e.image):u.image?[u.image]:[],productName:u.name})}),(0,a.jsxs)("div",{className:"flex flex-col order-2",children:[u.description&&(0,a.jsxs)("div",{className:"prose prose-sm max-w-none flex flex-col",children:[(0,a.jsx)("h2",{className:"text-lg sm:text-xl font-semibold text-slate-900 mb-3",children:"Description"}),(0,a.jsxs)("div",{className:"text-slate-700 leading-relaxed overflow-hidden relative max-h-[250px] sm:max-h-[350px] md:max-h-[400px] lg:max-h-[450px]",children:[(0,a.jsx)("div",{className:"overflow-y-auto pr-2 h-full",children:(0,a.jsx)(n.UG,{components:{p:e=>{let{children:s}=e;return(0,a.jsx)("p",{className:"mb-4 last:mb-0",children:s})},strong:e=>{let{children:s}=e;return(0,a.jsx)("strong",{className:"font-semibold text-slate-900",children:s})},em:e=>{let{children:s}=e;return(0,a.jsx)("em",{className:"italic",children:s})},ul:e=>{let{children:s}=e;return(0,a.jsx)("ul",{className:"list-disc list-inside mb-4 space-y-1",children:s})},ol:e=>{let{children:s}=e;return(0,a.jsx)("ol",{className:"list-decimal list-inside mb-4 space-y-1",children:s})},li:e=>{let{children:s}=e;return(0,a.jsx)("li",{className:"ml-2",children:s})},h1:e=>{let{children:s}=e;return(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-900 mb-3 mt-4",children:s})},h2:e=>{let{children:s}=e;return(0,a.jsx)("h2",{className:"text-xl font-semibold text-slate-900 mb-2 mt-4",children:s})},h3:e=>{let{children:s}=e;return(0,a.jsx)("h3",{className:"text-lg font-semibold text-slate-900 mb-2 mt-3",children:s})},code:e=>{let{children:s}=e;return(0,a.jsx)("code",{className:"bg-slate-100 px-1.5 py-0.5 rounded text-sm font-mono",children:s})},blockquote:e=>{let{children:s}=e;return(0,a.jsx)("blockquote",{className:"border-l-4 border-slate-300 pl-4 italic my-4",children:s})}},children:u.description})}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-20 bg-gradient-to-t from-white to-transparent pointer-events-none"})]}),(0,a.jsx)("button",{onClick:e=>{e.preventDefault(),M("info"),setTimeout(()=>{var e;null===(e=T.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"start"})},100)},className:"mt-4 text-sm font-medium text-primary hover:text-primary-dark transition-colors self-start",children:"En savoir plus â†’"})]}),ee&&es&&(0,a.jsx)("div",{className:"text-base sm:text-lg font-semibold text-slate-900 mt-4",children:ee===es?(0,a.jsx)("span",{children:y(ee)}):(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2",children:[(0,a.jsxs)("span",{children:["De ",y(ee)," \xe0 ",y(es)]}),ee<es&&(0,a.jsxs)("span",{className:"text-secondary text-sm sm:text-base",children:["(\xc9conomisez ",y(es-ee),")"]})]})})]})]}),(0,a.jsx)("div",{ref:T,className:"border-b border-slate-200",children:(0,a.jsxs)("nav",{className:"flex gap-4 sm:gap-6 overflow-x-auto",children:[(0,a.jsx)("button",{type:"button",onClick:()=>M("price"),className:"pb-3 px-2 sm:px-1 text-xs sm:text-sm font-medium border-b-2 transition-colors whitespace-nowrap flex-shrink-0 ".concat("price"===E?"border-primary text-primary":"border-transparent text-slate-600 hover:text-slate-900"),children:"Prix"}),(0,a.jsx)("button",{type:"button",onClick:()=>M("info"),className:"pb-3 px-2 sm:px-1 text-xs sm:text-sm font-medium border-b-2 transition-colors whitespace-nowrap flex-shrink-0 ".concat("info"===E?"border-primary text-primary":"border-transparent text-slate-600 hover:text-slate-900"),children:"Info produit"})]})}),(0,a.jsxs)("div",{className:"space-y-6",children:["price"===E&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-xs sm:text-sm text-slate-700 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:S,onChange:e=>C(e.target.checked),className:"rounded border-slate-300 text-primary focus:ring-primary flex-shrink-0"}),(0,a.jsx)("span",{className:"break-words",children:"Afficher seulement les offres disponibles en stock"})]}),$.length>0?(0,a.jsxs)("div",{className:"space-y-4",children:[el.map(e=>{var s,t,l,r,n;return(0,a.jsx)("div",{className:"border border-slate-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[(null===(s=e.merchant)||void 0===s?void 0:s.logo_display)||(null===(t=e.merchant)||void 0===t?void 0:t.logo)?(0,a.jsx)("img",{src:e.merchant.logo_display||e.merchant.logo,alt:e.merchant.name||"Merchant logo",className:"h-5 md:h-6 w-auto object-contain max-w-[100px] md:max-w-[120px] flex-shrink-0",onError:e=>{let s=e.currentTarget.nextElementSibling;s&&(s.style.display="block"),e.currentTarget.style.display="none"}}):null,(0,a.jsx)("h3",{className:"font-semibold text-slate-900 text-sm md:text-base ".concat((null===(l=e.merchant)||void 0===l?void 0:l.logo_display)||(null===(r=e.merchant)||void 0===r?void 0:r.logo)?"hidden":""),children:(null===(n=e.merchant)||void 0===n?void 0:n.name)||"Merchant"})]}),(0,a.jsx)("p",{className:"text-xs md:text-sm text-slate-600 font-medium mb-3 line-clamp-2",children:u.name}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mb-2",children:[(0,a.jsx)("span",{className:"font-semibold text-xs md:text-sm ".concat("in_stock"===e.stock_status?"text-green-600":"out_of_stock"===e.stock_status?"text-red-600":"text-yellow-600"),children:"in_stock"===e.stock_status?"En stock":"low_stock"===e.stock_status?"Stock faible":"out_of_stock"===e.stock_status?"Hors stock":e.stock_status}),(0,a.jsx)("span",{className:"font-bold text-base md:text-lg text-primary",children:y(e.price)}),e.date_updated&&(0,a.jsxs)("span",{className:"text-xs text-slate-500",children:[function(e){if(!e)return"";try{return new Date(e).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(s){return e}}(e.date_updated),"*"]})]}),e.date_updated&&(0,a.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"*Date de la derni\xe8re mise \xe0 jour du prix"})]}),(0,a.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-primary text-white text-xs sm:text-sm font-semibold rounded-lg hover:bg-primary-dark transition-colors whitespace-nowrap text-center flex-shrink-0 w-full sm:w-auto",children:"Voir l'offre"})]})},e.id)}),ea&&(0,a.jsx)("button",{onClick:()=>A(!_),className:"w-full py-2 text-xs sm:text-sm text-primary hover:underline break-words",type:"button",children:_?"Afficher moins (".concat($.length-5," offres cach\xe9es)"):"Afficher toutes les offres (".concat($.length-5," de plus)")}),(0,a.jsx)("p",{className:"text-xs text-slate-500 mt-4 break-words",children:"Avis aux utilisateurs : Nous r\xe9f\xe9ren\xe7ons r\xe9guli\xe8rement de nouvelles offres pour vous proposer le plus grand choix, n\xe9anmoins les r\xe9sultats affich\xe9s ne refl\xe8tent pas l'int\xe9gralit\xe9 des offres disponibles sur le march\xe9. Par d\xe9faut, les offres sont class\xe9es par prix ; l'offre la moins ch\xe8re appara\xeet en premi\xe8re position."})]}):(0,a.jsx)("div",{className:"border border-dashed border-slate-300 rounded-lg p-8 text-center",children:(0,a.jsx)("p",{className:"text-slate-500",children:S?"Aucune offre en stock disponible pour le moment.":"Aucune offre disponible pour le moment."})}),Q&&(0,a.jsx)("div",{className:"border-t border-slate-200 pt-6 mt-6",children:F?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-slate-900",children:"Ajouter une offre"}),O&&(0,a.jsx)("div",{className:"rounded-md p-4 ".concat("success"===O.type?"bg-green-50 text-green-800":"bg-red-50 text-red-800"),children:O.text}),(0,a.jsxs)("form",{onSubmit:X,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Marchand"}),(0,a.jsxs)("select",{value:U.merchant_id||"",onChange:e=>{let s=e.target.value?parseInt(e.target.value):void 0;J(e=>({...e,merchant_id:s,merchant_name:s?void 0:e.merchant_name}))},className:"w-full rounded-md border-slate-300 px-3 py-2 shadow-sm focus:border-primary focus:ring-primary",children:[(0,a.jsx)("option",{value:"",children:"S\xe9lectionner un marchand existant"}),D.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:"ou"}),(0,a.jsx)("input",{type:"text",value:U.merchant_name||"",onChange:e=>J(s=>({...s,merchant_name:e.target.value,merchant_id:e.target.value?void 0:s.merchant_id})),placeholder:"Nom du nouveau marchand",className:"mt-1 w-full rounded-md border-slate-300 px-3 py-2 shadow-sm focus:border-primary focus:ring-primary",disabled:!!U.merchant_id})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Prix (MAD) *"}),(0,a.jsx)("input",{type:"number",step:"0.01",min:"0",value:U.price||"",onChange:e=>J(s=>({...s,price:parseFloat(e.target.value)||0})),required:!0,className:"w-full rounded-md border-slate-300 px-3 py-2 shadow-sm focus:border-primary focus:ring-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Lien du produit (optionnel)"}),(0,a.jsx)("input",{type:"url",value:U.url||"",onChange:e=>J(s=>({...s,url:e.target.value})),placeholder:"https://example.com/product",className:"w-full rounded-md border-slate-300 px-3 py-2 shadow-sm focus:border-primary focus:ring-primary"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Statut du stock"}),(0,a.jsxs)("select",{value:U.stock_status,onChange:e=>J(s=>({...s,stock_status:e.target.value})),className:"w-full rounded-md border-slate-300 px-3 py-2 shadow-sm focus:border-primary focus:ring-primary",children:[(0,a.jsx)("option",{value:"in_stock",children:"En stock"}),(0,a.jsx)("option",{value:"low_stock",children:"Stock faible"}),(0,a.jsx)("option",{value:"out_of_stock",children:"Rupture de stock"})]})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,a.jsx)("button",{type:"submit",disabled:z,className:"flex-1 rounded-md bg-primary px-4 py-2 text-xs sm:text-sm font-medium text-white hover:bg-primary/90 disabled:opacity-50",children:z?"Envoi...":"Soumettre l'offre"}),(0,a.jsx)("button",{type:"button",onClick:()=>{P(!1),R(null),J({product_slug:t,price:0,stock_status:"in_stock",currency:"MAD"})},className:"rounded-md border border-slate-300 px-4 py-2 text-xs sm:text-sm font-medium text-slate-700 hover:bg-slate-50",children:"Annuler"})]}),(0,a.jsx)("p",{className:"text-xs text-slate-500",children:"* Votre offre sera examin\xe9e par un administrateur avant d'\xeatre publi\xe9e."})]})]}):(0,a.jsx)("button",{type:"button",onClick:()=>P(!0),className:"w-full rounded-md bg-primary px-4 py-2 text-sm font-medium text-white hover:bg-primary/90",children:"Ajouter une offre"})})]}),"info"===E&&(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,a.jsx)("h2",{className:"text-lg sm:text-xl font-semibold text-slate-900",children:"Information produit"}),u.description&&(0,a.jsx)("div",{className:"text-slate-700 leading-relaxed",children:(0,a.jsx)(n.UG,{components:{p:e=>{let{children:s}=e;return(0,a.jsx)("p",{className:"mb-4 last:mb-0",children:s})},strong:e=>{let{children:s}=e;return(0,a.jsx)("strong",{className:"font-semibold text-slate-900",children:s})},em:e=>{let{children:s}=e;return(0,a.jsx)("em",{className:"italic",children:s})},ul:e=>{let{children:s}=e;return(0,a.jsx)("ul",{className:"list-disc list-inside mb-4 space-y-1",children:s})},ol:e=>{let{children:s}=e;return(0,a.jsx)("ol",{className:"list-decimal list-inside mb-4 space-y-1",children:s})},li:e=>{let{children:s}=e;return(0,a.jsx)("li",{className:"ml-2",children:s})},h1:e=>{let{children:s}=e;return(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-900 mb-3 mt-4",children:s})},h2:e=>{let{children:s}=e;return(0,a.jsx)("h2",{className:"text-xl font-semibold text-slate-900 mb-2 mt-4",children:s})},h3:e=>{let{children:s}=e;return(0,a.jsx)("h3",{className:"text-lg font-semibold text-slate-900 mb-2 mt-3",children:s})},code:e=>{let{children:s}=e;return(0,a.jsx)("code",{className:"bg-slate-100 px-1.5 py-0.5 rounded text-sm font-mono",children:s})},blockquote:e=>{let{children:s}=e;return(0,a.jsx)("blockquote",{className:"border-l-4 border-slate-300 pl-4 italic my-4",children:s})}},children:u.description})}),Object.keys(u.specs||{}).length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-base sm:text-lg font-semibold text-slate-900 mb-3 break-words",children:[null===(s=u.category)||void 0===s?void 0:s.name," ",u.brand," Maroc"]}),(0,a.jsxs)("dl",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between py-2 border-b border-slate-200 gap-1 sm:gap-0",children:[(0,a.jsx)("dt",{className:"font-medium text-slate-700 text-sm sm:text-base",children:"Produit"}),(0,a.jsx)("dd",{className:"text-slate-900 font-semibold text-sm sm:text-base",children:"Nom"})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between py-2 border-b border-slate-200 gap-1 sm:gap-0",children:[(0,a.jsx)("dt",{className:"font-medium text-slate-700 text-sm sm:text-base",children:"Nom"}),(0,a.jsx)("dd",{className:"text-slate-900 font-semibold text-sm sm:text-base break-words",children:u.name})]}),u.category&&(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between py-2 border-b border-slate-200 gap-1 sm:gap-0",children:[(0,a.jsx)("dt",{className:"font-medium text-slate-700 text-sm sm:text-base",children:"Cat\xe9gorie"}),(0,a.jsx)("dd",{className:"text-slate-900 font-semibold text-sm sm:text-base",children:(0,a.jsx)(r.default,{href:"/categories/".concat(u.category.slug),className:"hover:text-primary break-words",children:u.category.name})})]}),u.brand&&(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between py-2 border-b border-slate-200 gap-1 sm:gap-0",children:[(0,a.jsx)("dt",{className:"font-medium text-slate-700 text-sm sm:text-base",children:"Marque"}),(0,a.jsx)("dd",{className:"text-slate-900 font-semibold text-sm sm:text-base break-words",children:u.brand})]}),Object.entries(u.specs||{}).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between py-2 border-b border-slate-200 gap-1 sm:gap-0",children:[(0,a.jsx)("dt",{className:"font-medium text-slate-700 text-sm sm:text-base break-words",children:s}),(0,a.jsx)("dd",{className:"text-slate-900 font-semibold text-sm sm:text-base break-words text-right sm:text-left",children:String(t)})]},s)})]})]})]})]}),Z.length>0&&(0,a.jsxs)("section",{className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-slate-900",children:"Produits similaires"}),q?(0,a.jsx)("div",{className:"flex gap-4 overflow-x-auto pb-4",children:[1,2,3,4].map(e=>(0,a.jsx)("div",{className:"min-w-[250px] sm:min-w-[280px] h-96 animate-pulse rounded-3xl bg-slate-200"},e))}):(0,a.jsx)(p,{children:Z.map(e=>{var s;return(0,a.jsx)("div",{className:"min-w-[250px] sm:min-w-[280px] snap-start",children:(0,a.jsx)(f.Z,{product:{id:e.id,name:e.name,slug:e.slug,image:e.image,image_display:e.image_display,image_file:e.image_file,lowestPrice:null!==(s=e.lowestPrice)&&void 0!==s?s:e.lowest_price}})},e.id)})})]}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(g.Z,{slot:"product_detail_bottom",className:"my-8"})})]}):(0,a.jsx)("p",{className:"text-center text-sm text-slate-500",children:"Produit introuvable."})}v.displayName="ProductImageGallery"},3429:function(e,s,t){t.d(s,{H:function(){return c},a:function(){return d}});var a=t(7437),l=t(2265),r=t(9988);let n=(0,l.createContext)(void 0),o="primini_auth";function i(e){if(!e){console.warn("getAuthHeader called with null tokens");return}if(e.access){let s={Authorization:"Bearer ".concat(e.access)};return console.log("Using Bearer token for auth"),s}if(e.key){let s={Authorization:"Token ".concat(e.key)};return console.log("Using Token for auth, token length:",e.key.length),s}console.warn("No valid token found in tokens object:",e)}function c(e){let{children:s}=e,[t,c]=function(){let[e,s]=(0,l.useState)(()=>{let e=window.localStorage.getItem(o);if(!e)return console.log("No stored auth tokens found"),null;try{var s;let t=JSON.parse(e);return console.log("Loaded tokens from localStorage:",{hasKey:!!t.key,hasAccess:!!t.access,keyLength:(null===(s=t.key)||void 0===s?void 0:s.length)||0}),t}catch(e){return console.warn("Failed to parse auth tokens",e),null}});return[e,(0,l.useCallback)(e=>{if(s(e),e){var t;console.log("Storing tokens to localStorage:",{hasKey:!!e.key,hasAccess:!!e.access,keyLength:(null===(t=e.key)||void 0===t?void 0:t.length)||0}),window.localStorage.setItem(o,JSON.stringify(e))}else console.log("Clearing tokens from localStorage"),window.localStorage.removeItem(o)},[])]}(),[d,m]=(0,l.useState)(null),[x,u]=(0,l.useState)(!0);(0,l.useEffect)(()=>{!async function(){if(u(!0),!(null==t?void 0:t.access)&&!(null==t?void 0:t.key)){m(null),u(!1);return}try{let e=i(t);console.log("Fetching user on mount/update with headers:",e);let s=await r.Z.get("/auth/user/",{headers:e});console.log("User fetched successfully:",JSON.stringify(s.data,null,2)),console.log("User role from API:",s.data.role);let a={...s.data,role:s.data.role||"visitor"};console.log("Setting user data:",JSON.stringify(a,null,2)),console.log("isAdmin will be:","admin"===a.role),m(a)}catch(t){var e,s,a;console.error("Failed to fetch user profile:",t),console.error("Error response:",null===(e=t.response)||void 0===e?void 0:e.data),console.error("Error status:",null===(s=t.response)||void 0===s?void 0:s.status),(null===(a=t.response)||void 0===a?void 0:a.status)===401&&(c(null),m(null))}finally{u(!1)}}()},[c,t]);let h=(0,l.useCallback)(async(e,s)=>{let t=await r.Z.post("/auth/login/",{email:e,password:s});console.log("Login response:",t.data),console.log("Login response keys:",Object.keys(t.data||{}));let a=t.data,l={key:a.key||a.token||a.token_key,access:a.access,refresh:a.refresh};if(!l.key&&!l.access)throw console.error("No token received in login response:",t.data),console.error("Response structure:",JSON.stringify(t.data,null,2)),Error("Aucun token re\xe7u lors de la connexion. R\xe9ponse: "+JSON.stringify(t.data));console.log("Token extracted successfully:",{hasKey:!!l.key,hasAccess:!!l.access,keyPreview:l.key?l.key.substring(0,10)+"...":"none"}),c(l);try{let e=i(l);console.log("Fetching user with headers:",e);let s=await r.Z.get("/auth/user/",{headers:e});console.log("User response:",JSON.stringify(s.data,null,2)),console.log("User role from API:",s.data.role);let t={...s.data,role:s.data.role||"visitor"};console.log("Setting user data:",JSON.stringify(t,null,2)),m(t)}catch(e){var n,o;throw console.error("Failed to fetch user profile after login:",e),console.error("Error response:",null===(n=e.response)||void 0===n?void 0:n.data),console.error("Error status:",null===(o=e.response)||void 0===o?void 0:o.status),e}},[c]),p=(0,l.useCallback)(async e=>{await r.Z.post("/auth/registration/",e)},[]),f=(0,l.useCallback)(()=>{c(null),m(null)},[c]),g=(0,l.useMemo)(()=>(null==d?void 0:d.role)==="admin",[d]),b=(0,l.useMemo)(()=>(null==d?void 0:d.role)==="client",[d]),v=(0,l.useMemo)(()=>(null==d?void 0:d.role)==="user",[d]),j=(0,l.useMemo)(()=>(null==d?void 0:d.role)==="visitor",[d]),y=(0,l.useMemo)(()=>({user:d,tokens:t,loading:x,isAdmin:g,isClient:b,isUser:v,isVisitor:j,login:h,register:p,logout:f}),[x,h,f,p,t,d,g,b,v,j]);return(0,a.jsx)(n.Provider,{value:y,children:s})}function d(){let e=(0,l.useContext)(n);if(!e)throw Error("useAuth must be used within AuthProvider");return e}}}]);