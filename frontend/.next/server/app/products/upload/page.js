(()=>{var e={};e.id=948,e.ids=[948],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},4004:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>a.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d}),r(2840),r(3432),r(179),r(5866);var s=r(3191),i=r(8716),n=r(7922),a=r.n(n),l=r(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let d=["",{children:["products",{children:["upload",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,2840)),"/Users/khairallahmohammed/Documents/primini/frontend/app/products/upload/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,3432)),"/Users/khairallahmohammed/Documents/primini/frontend/app/products/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,179)),"/Users/khairallahmohammed/Documents/primini/frontend/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/khairallahmohammed/Documents/primini/frontend/app/products/upload/page.tsx"],u="/products/upload/page",m={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/products/upload/page",pathname:"/products/upload",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},9:(e,t,r)=>{Promise.resolve().then(r.bind(r,9959))},7822:(e,t,r)=>{Promise.resolve().then(r.bind(r,3047)),Promise.resolve().then(r.bind(r,933)),Promise.resolve().then(r.bind(r,6618))},9959:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var s=r(326),i=r(5047),n=r(732),a=r(9965),l=r(2056);function o({children:e}){let t=(0,i.usePathname)(),{isAdmin:r}=(0,n.a)(),o=t?.includes("/products/")&&t?.includes("/edit");return r&&t&&(["/products/create","/products/upload"].includes(t)||o)?s.jsx(a.Z,{requireAuth:!0,requireClientOrAdmin:!0,children:s.jsx(l.Z,{children:e})}):s.jsx(a.Z,{requireAuth:!0,requireClientOrAdmin:!0,children:e})}},9965:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var s=r(326);r(7577);var i=r(5047),n=r(732);function a({children:e,requireAuth:t=!1,requireAdmin:r=!1,requireClient:a=!1,requireClientOrAdmin:l=!1,redirectTo:o="/login"}){(0,i.useRouter)();let{user:d,loading:c,isAdmin:u,isClient:m,isVisitor:p}=(0,n.a)();return c?s.jsx("div",{className:"flex min-h-screen items-center justify-center",children:s.jsx("div",{className:"text-lg",children:"Chargement..."})}):(!t||d)&&(!r||u)&&(!a||m)&&(!l||m||u)?s.jsx(s.Fragment,{children:e}):null}},2056:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var s=r(326),i=r(7577),n=r(434),a=r(6226),l=r(5047),o=r(732);let d=[{title:"Tableau de bord",href:"/admin",icon:"\uD83D\uDCCA"},{title:"Gestion des produits",items:[{title:"Tous les produits",href:"/admin"},{title:"Cr\xe9er un produit",href:"/products/create"},{title:"Importer CSV",href:"/products/upload"}],icon:"\uD83D\uDCE6"},{title:"Gestion des utilisateurs",href:"/admin/users",icon:"\uD83D\uDC65"},{title:"Configuration AdSense",href:"/admin/adsense",icon:"\uD83D\uDCB0"}];function c({children:e}){let t=(0,l.usePathname)(),{user:r}=(0,o.a)(),[c,u]=(0,i.useState)(!0),m=e=>"/admin"===e?"/admin"===t:"/admin/users"===e?t.startsWith("/admin/users"):t.startsWith(e);return(0,s.jsxs)("div",{className:"flex h-screen w-full overflow-hidden bg-gray-50",children:[(0,s.jsxs)("aside",{className:`${c?"w-64":"w-20"} fixed left-0 top-0 z-50 h-screen bg-primary border-r border-primary-dark/30 transition-all duration-300 flex flex-col shadow-lg`,children:[(0,s.jsxs)("div",{className:"flex h-24 items-center justify-between border-b border-primary-dark/30 px-4",children:[s.jsx(n.default,{href:"/",className:`flex items-center ${c?"justify-start":"justify-center"} flex-1`,children:s.jsx(a.default,{src:"/images/avito-colors.jpeg",alt:"Avita",width:c?180:50,height:c?60:50,className:`${c?"h-16 w-auto":"h-12 w-12"} object-contain transition-all`,priority:!0})}),s.jsx("button",{onClick:()=>u(!c),className:"rounded-md p-2 text-white/80 hover:bg-primary-dark/30 hover:text-white transition-colors","aria-label":"Toggle sidebar",children:c?s.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):s.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]}),s.jsx("nav",{className:"flex-1 overflow-y-auto px-3 py-4",children:s.jsx("ul",{className:"space-y-1",children:d.map((e,t)=>e.items?(0,s.jsxs)("li",{children:[(0,s.jsxs)("div",{className:`flex items-center gap-3 px-3 py-2 text-sm font-medium text-white/90 ${!c&&"justify-center"}`,children:[s.jsx("span",{className:"text-lg",children:e.icon}),c&&s.jsx("span",{children:e.title})]}),c&&s.jsx("ul",{className:"ml-6 mt-1 space-y-1",children:e.items.map(e=>s.jsx("li",{children:s.jsx(n.default,{href:e.href,className:`block rounded-md px-3 py-2 text-sm transition-colors ${m(e.href)?"bg-white/20 text-white font-medium":"text-white/70 hover:bg-white/10 hover:text-white"}`,children:e.title})},e.href))})]},t):s.jsx("li",{children:(0,s.jsxs)(n.default,{href:e.href,className:`flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors ${m(e.href)?"bg-white/20 text-white":"text-white/80 hover:bg-white/10 hover:text-white"} ${!c&&"justify-center"}`,children:[s.jsx("span",{className:"text-lg",children:e.icon}),c&&s.jsx("span",{children:e.title})]})},e.href))})}),c&&r&&s.jsx("div",{className:"border-t border-primary-dark/30 p-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-white/20 text-white font-semibold",children:(r.first_name?.[0]||r.username?.[0]||r.email[0]||"U").toUpperCase()}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"truncate text-sm font-medium text-white",children:r.first_name&&r.last_name?`${r.first_name} ${r.last_name}`:r.username||r.email}),s.jsx("p",{className:"truncate text-xs text-white/70",children:r.email})]})]})})]}),s.jsx("div",{className:`flex-1 w-full h-screen overflow-y-auto transition-all duration-300 ${c?"ml-64":"ml-20"}`,style:{marginTop:0},children:s.jsx("div",{className:"h-full w-full",children:e})})]})}},3047:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var s=r(326),i=r(7577),n=r(732),a=r(9806),l=r(434);function o(){let{tokens:e}=(0,n.a)(),[t,r]=(0,i.useState)(null),[o,d]=(0,i.useState)(!1),[c,u]=(0,i.useState)(null),[m,p]=(0,i.useState)(null),x=async s=>{if(s.preventDefault(),!t||!e?.key){u("Veuillez s\xe9lectionner un fichier");return}d(!0),u(null),p(null);try{let s=await (0,a.g4)(t,e.key);p(s),r(null);let i=document.getElementById("csv-file");i&&(i.value="")}catch(e){u(e.response?.data?.detail||e.message||"Une erreur est survenue lors de l'upload")}finally{d(!1)}};return s.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:s.jsx("div",{className:"mx-auto max-w-3xl",children:(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Importer des produits depuis CSV"}),(0,s.jsxs)("div",{className:"mb-6 rounded-md bg-blue-50 p-4 text-blue-800",children:[s.jsx("h2",{className:"font-semibold mb-2",children:"Format requis (CSV ou Excel):"}),s.jsx("p",{className:"text-sm mb-2",children:"Le fichier CSV ou Excel (.xlsx, .xls) doit contenir les colonnes suivantes:"}),(0,s.jsxs)("ul",{className:"text-sm list-disc list-inside space-y-1",children:[(0,s.jsxs)("li",{children:[s.jsx("strong",{children:"name"})," (requis) - Nom du produit"]}),(0,s.jsxs)("li",{children:[s.jsx("strong",{children:"description"})," - Description du produit"]}),(0,s.jsxs)("li",{children:[s.jsx("strong",{children:"brand"})," - Marque"]}),(0,s.jsxs)("li",{children:[s.jsx("strong",{children:"category"})," - Nom de la cat\xe9gorie"]}),(0,s.jsxs)("li",{children:[s.jsx("strong",{children:"image"})," - URL de l'image"]}),(0,s.jsxs)("li",{children:[s.jsx("strong",{children:"price"})," - Prix en MAD"]}),(0,s.jsxs)("li",{children:[s.jsx("strong",{children:"merchant"})," - Nom du marchand"]}),(0,s.jsxs)("li",{children:[s.jsx("strong",{children:"url"})," - URL du produit"]}),(0,s.jsxs)("li",{children:[s.jsx("strong",{children:"tags"})," - Tags s\xe9par\xe9s par des virgules"]})]}),(0,s.jsxs)("p",{className:"text-sm mt-2",children:[s.jsx("strong",{children:"Note:"})," Les produits cr\xe9\xe9s par les clients n\xe9cessitent une approbation admin."]})]}),c&&s.jsx("div",{className:"mb-4 rounded-md bg-red-50 p-4 text-red-800",children:c}),m&&(0,s.jsxs)("div",{className:"mb-4 rounded-md bg-green-50 p-4",children:[s.jsx("div",{className:"font-semibold text-green-800 mb-2",children:m.message}),(0,s.jsxs)("div",{className:"text-sm text-green-700 space-y-1",children:[(0,s.jsxs)("p",{children:["✓ Produits cr\xe9\xe9s: ",m.success]}),(0,s.jsxs)("p",{children:["✓ Approuv\xe9s: ",m.approved]}),(0,s.jsxs)("p",{children:["⏳ En attente: ",m.pending]}),m.total_errors>0&&(0,s.jsxs)("p",{className:"text-red-600",children:["✗ Erreurs: ",m.total_errors]})]}),m.errors.length>0&&(0,s.jsxs)("div",{className:"mt-3 text-sm",children:[s.jsx("p",{className:"font-semibold text-red-600",children:"Erreurs d\xe9taill\xe9es:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside text-red-600 space-y-1",children:[m.errors.slice(0,10).map((e,t)=>s.jsx("li",{children:e},t)),m.errors.length>10&&(0,s.jsxs)("li",{children:["... et ",m.errors.length-10," autres erreurs"]})]})]})]}),(0,s.jsxs)("form",{onSubmit:x,className:"space-y-6",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"csv-file",className:"block text-sm font-medium text-gray-700 mb-2",children:"S\xe9lectionner un fichier CSV"}),s.jsx("input",{type:"file",id:"csv-file",accept:".csv,.xlsx,.xls",onChange:e=>{let t=e.target.files?.[0];if(t){if(!["csv","xlsx","xls"].includes(t.name.toLowerCase().split(".").pop()||"")){u("Le fichier doit \xeatre un CSV ou Excel (.xlsx, .xls)");return}r(t),u(null),p(null)}},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-primary/90"}),t&&(0,s.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["Fichier s\xe9lectionn\xe9: ",s.jsx("strong",{children:t.name})," (",(t.size/1024).toFixed(2)," KB)"]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-4",children:[s.jsx(l.default,{href:"/",className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Annuler"}),s.jsx("button",{type:"submit",disabled:!t||o,className:"rounded-md bg-primary px-4 py-2 text-sm font-medium text-white hover:bg-primary/90 disabled:opacity-50",children:o?"Upload en cours...":"Importer"})]})]})]})})})}function d(){return s.jsx(o,{})}},9806:(e,t,r)=>{"use strict";r.d(t,{BB:()=>l,Dg:()=>c,EE:()=>u,ch:()=>a,ex:()=>d,g4:()=>n,h7:()=>o,kR:()=>m,t$:()=>p});var s=r(1980);function i(e){return e?{Authorization:`Token ${e}`}:{}}async function n(e,t){let r=new FormData;return r.append("file",e),(await s.Z.post("/products/upload_csv/",r,{headers:{...i(t),"Content-Type":"multipart/form-data"}})).data}async function a(e,t=1,r){let n={page:t.toString()};return r&&(n.approval_status=r),(await s.Z.get("/products/my_products/",{headers:i(e),params:n})).data}async function l(e,t=1){return(await s.Z.get("/products/pending/",{headers:i(e),params:{page:t}})).data}async function o(e,t){return(await s.Z.post(`/products/${e}/approve/`,{action:"approve"},{headers:i(t)})).data}async function d(e,t,r){return(await s.Z.post(`/products/${e}/approve/`,{action:"reject",rejection_reason:t},{headers:i(r)})).data}async function c(e,t=1,r,n){let a={page:t.toString()};return r&&(a.approval_status=r),n&&(a.search=n),(await s.Z.get("/products/",{headers:i(e),params:a})).data}async function u(e,t=1){return(await s.Z.get("/offers/pending/",{headers:{Authorization:`Token ${e}`},params:{page:t}})).data}async function m(e,t){return(await s.Z.post(`/offers/${e}/approve/`,{},{headers:{Authorization:`Token ${t}`}})).data}async function p(e,t,r){return(await s.Z.post(`/offers/${e}/reject/`,{rejection_reason:t},{headers:{Authorization:`Token ${r}`}})).data}},933:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return i}});let s=r(4129);function i(e){let{reason:t,children:r}=e;throw new s.BailoutToCSRError(t)}},6618:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return n}});let s=r(326),i=r(5403);function n(e){let{moduleIds:t}=e,r=(0,i.getExpectedRequestStore)("next/dynamic css"),n=[];if(r.reactLoadableManifest&&t){let e=r.reactLoadableManifest;for(let r of t){if(!e[r])continue;let t=e[r].files.filter(e=>e.endsWith(".css"));n.push(...t)}}return 0===n.length?null:(0,s.jsx)(s.Fragment,{children:n.map(e=>(0,s.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:r.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}},3432:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>a,__esModule:()=>n,default:()=>l});var s=r(8570);let i=(0,s.createProxy)(String.raw`/Users/khairallahmohammed/Documents/primini/frontend/app/products/layout.tsx`),{__esModule:n,$$typeof:a}=i;i.default;let l=(0,s.createProxy)(String.raw`/Users/khairallahmohammed/Documents/primini/frontend/app/products/layout.tsx#default`)},2840:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var s=r(9510);let i=(0,r(8318).default)(()=>r.e(1852).then(r.bind(r,1852)),{loadableGenerated:{modules:["app/products/upload/page.tsx -> ../../../components/screens/CSVUploadScreen"]},ssr:!1});function n(){return s.jsx(i,{})}},8318:(e,t,r)=>{"use strict";r.d(t,{default:()=>i.a});var s=r(4567),i=r.n(s)},4567:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n}});let s=r(3370);r(9510),r(1159);let i=s._(r(6155));function n(e,t){var r;let s={loading:e=>{let{error:t,isLoading:r,pastDelay:s}=e;return null}};"function"==typeof e&&(s.loader=e);let n={...s,...t};return(0,i.default)({...n,modules:null==(r=n.loadableGenerated)?void 0:r.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},3689:(e,t,r)=>{"use strict";let{createProxy:s}=r(8570);e.exports=s("/Users/khairallahmohammed/Documents/primini/frontend/node_modules/next/dist/shared/lib/lazy-dynamic/dynamic-bailout-to-csr.js")},6155:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return d}});let s=r(9510),i=r(1159),n=r(3689),a=r(4459);function l(e){return{default:e&&"default"in e?e.default:e}}let o={loader:()=>Promise.resolve(l(()=>null)),loading:null,ssr:!0},d=function(e){let t={...o,...e},r=(0,i.lazy)(()=>t.loader().then(l)),d=t.loading;function c(e){let l=d?(0,s.jsx)(d,{isLoading:!0,pastDelay:!0,error:null}):null,o=t.ssr?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.PreloadCss,{moduleIds:t.modules}),(0,s.jsx)(r,{...e})]}):(0,s.jsx)(n.BailoutToCSR,{reason:"next/dynamic",children:(0,s.jsx)(r,{...e})});return(0,s.jsx)(i.Suspense,{fallback:l,children:o})}return c.displayName="LoadableComponent",c}},4459:(e,t,r)=>{"use strict";let{createProxy:s}=r(8570);e.exports=s("/Users/khairallahmohammed/Documents/primini/frontend/node_modules/next/dist/shared/lib/lazy-dynamic/preload-css.js")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9797,7325],()=>r(4004));module.exports=s})();